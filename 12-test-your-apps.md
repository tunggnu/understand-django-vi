# Ki·ªÉm Th·ª≠ ·ª®ng D·ª•ng C·ªßa B·∫°n

Trong b√†i vi·∫øt tr∆∞·ªõc c·ªßa lo·∫°t b√†i [Hi·ªÉu v·ªÅ Django](https://www.mattlayman.com/understand-django/), ch√∫ng ta ƒë√£ th·∫•y c√°ch c√°c static files nh∆∞ CSS, JavaScript v√† h√¨nh ·∫£nh c√≥ th·ªÉ ƒë∆∞·ª£c t√≠ch h·ª£p v√†o trang web c·ªßa b·∫°n. B√¢y gi·ªù, ch√∫ng ta s·∫Ω t·∫≠p trung v√†o c√°ch x√°c minh r·∫±ng website c·ªßa b·∫°n ho·∫°t ƒë·ªông ƒë√∫ng v√† ti·∫øp t·ª•c ho·∫°t ƒë·ªông ƒë√∫ng b·∫±ng c√°ch vi·∫øt c√°c ki·ªÉm th·ª≠ t·ª± ƒë·ªông ƒë·ªÉ ki·ªÉm tra c√°c trang v√† logic m√£ ngu·ªìn c·ªßa b·∫°n.

1. [T·ª´ Tr√¨nh Duy·ªát ƒê·∫øn Django](https://www.mattlayman.com/understand-django/browser-to-django/)
2. [URLs D·∫´n ƒê∆∞·ªùng](https://www.mattlayman.com/understand-django/urls-lead-way/)
3. [G√≥c Nh√¨n V·ªÅ Views](https://www.mattlayman.com/understand-django/views-on-views/)
4. [Template Cho Giao Di·ªán Ng∆∞·ªùi D√πng](https://www.mattlayman.com/understand-django/templates-user-interfaces/)
5. [T∆∞∆°ng T√°c Ng∆∞·ªùi D√πng V·ªõi Forms](https://www.mattlayman.com/understand-django/user-interaction-forms/)
6. [L∆∞u Tr·ªØ D·ªØ Li·ªáu V·ªõi Models](https://www.mattlayman.com/understand-django/store-data-with-models/)
7. [Qu·∫£n Tr·ªã M·ªçi Th·ª©](https://www.mattlayman.com/understand-django/administer-all-the-things/)
8. [Gi·∫£i Ph·∫´u M·ªôt ·ª®ng D·ª•ng](https://www.mattlayman.com/understand-django/anatomy-of-an-application/)
9. [X√°c Th·ª±c Ng∆∞·ªùi D√πng](https://www.mattlayman.com/understand-django/user-authentication/)
10. [Middleware B·∫°n ƒêi ƒê√¢u?](https://www.mattlayman.com/understand-django/middleware-do-you-go/)
11. [Ph·ª•c V·ª• Static Files](https://www.mattlayman.com/understand-django/serving-static-files/)
12. Ki·ªÉm Th·ª≠ ·ª®ng D·ª•ng C·ªßa B·∫°n
13. [Tri·ªÉn Khai Trang Web](https://www.mattlayman.com/understand-django/deploy-site-live/)
14. [D·ªØ Li·ªáu Theo T·ª´ng Ng∆∞·ªùi D√πng V·ªõi Sessions](https://www.mattlayman.com/understand-django/sessions/)
15. [Hi·ªÉu V·ªÅ Settings](https://www.mattlayman.com/understand-django/settings/)
16. [Qu·∫£n L√Ω File Ng∆∞·ªùi D√πng](https://www.mattlayman.com/understand-django/media-files/)
17. [L·ªánh Cho ·ª®ng D·ª•ng](https://www.mattlayman.com/understand-django/command-apps/)
18. [TƒÉng T·ªëc V·ªõi Django](https://www.mattlayman.com/understand-django/go-fast/)
19. [B·∫£o M·∫≠t V√† Django](https://www.mattlayman.com/understand-django/secure-apps/)
20. [M·∫πo V√† K·ªπ Thu·∫≠t G·ª° L·ªói](https://www.mattlayman.com/understand-django/debugging-tips-techniques/)

## T·∫°i Sao C·∫ßn Vi·∫øt Ki·ªÉm Th·ª≠

T√¥i s·∫Ω gi·∫£ ƒë·ªãnh r·∫±ng n·∫øu b·∫°n ƒëang ƒë·ªçc b√†i n√†y, th√¨ b·∫°n ƒë√£ c√≥ m·ªôt d·ª± √°n Django ho·∫∑c ƒëang c√¢n nh·∫Øc l√†m vi·ªác v·ªõi Django ƒë·ªÉ x√¢y d·ª±ng m·ªôt d·ª± √°n. N·∫øu ƒë√∫ng nh∆∞ v·∫≠y, h√£y nghƒ© v·ªÅ d·ª± √°n c·ªßa b·∫°n v√† c√°ch b·∫°n s·∫Ω ƒë·∫£m b·∫£o n√≥ ho·∫°t ƒë·ªông ƒë√∫ng.

Khi b·∫°n b·∫Øt ƒë·∫ßu v·ªõi m·ªôt d·ª± √°n, d√π l√† cho m·ªôt h∆∞·ªõng d·∫´n hay cho m·ªôt th·ª© g√¨ ƒë√≥ th·ª±c t·∫ø m√† b·∫°n d·ª± ƒë·ªãnh ph√°t tri·ªÉn, trang web ban ƒë·∫ßu c√≥ r·∫•t √≠t ch·ª©c nƒÉng. ƒê·ªÉ ki·ªÉm tra xem trang c√≥ ho·∫°t ƒë·ªông kh√¥ng, b·∫°n c√≥ th·ªÉ kh·ªüi ƒë·ªông web server c·ª•c b·ªô, m·ªü tr√¨nh duy·ªát, truy c·∫≠p URL `localhost` v√† x√°c nh·∫≠n r·∫±ng trang ho·∫°t ƒë·ªông. Vi·ªác ƒë√≥ m·∫•t bao l√¢u? 5 gi√¢y? 15 gi√¢y? 30 gi√¢y?

Khi m·ªõi b·∫Øt ƒë·∫ßu, ki·ªÉm tra th·ªß c√¥ng trang web c·ªßa b·∫°n l√† ·ªïn. Tuy nhi√™n, ƒëi·ªÅu g√¨ s·∫Ω x·∫£y ra khi b·∫°n t·∫°o th√™m nhi·ªÅu trang? L√†m sao b·∫°n ti·∫øp t·ª•c x√°c nh·∫≠n r·∫±ng t·∫•t c·∫£ c√°c trang ƒë·ªÅu ho·∫°t ƒë·ªông? B·∫°n c√≥ th·ªÉ m·ªü trang c·ª•c b·ªô v√† b·∫Øt ƒë·∫ßu click quanh, nh∆∞ng th·ªùi gian x√°c nh·∫≠n m·ªçi th·ª© ho·∫°t ƒë·ªông s·∫Ω tƒÉng l√™n. C√≥ th·ªÉ n·ªó l·ª±c x√°c minh c·ªßa b·∫°n m·∫•t 3 ph√∫t, 5 ph√∫t, ho·∫∑c th·∫≠m ch√≠ nhi·ªÅu h∆°n. N·∫øu b·∫°n kh√¥ng c·∫©n th·∫≠n, s·∫£n ph·∫©m c·ªßa b·∫°n c√≥ th·ªÉ b·∫Øt ƒë·∫ßu gi·ªëng nh∆∞ con qu√°i v·∫≠t nhi·ªÅu ƒë·∫ßu Hydra trong th·∫ßn tho·∫°i, v√† th·ª© t·ª´ng l√† m·ªôt d·ª± √°n vui v·∫ª ƒë·ªÉ l√†m s·∫Ω tr·ªü th√†nh m·ªôt c√¥ng vi·ªác nh√†m ch√°n ki·ªÉm tra t·ª´ng trang.

B·∫°n kh√¥ng th·ªÉ lo·∫°i b·ªè th·ª±c t·∫ø r·∫±ng d·ª± √°n c√†ng l·ªõn th√¨ c√†ng c√≥ nhi·ªÅu th·ª© c·∫ßn ki·ªÉm tra. ƒêi·ªÅu b·∫°n _c√≥ th·ªÉ_ l√†m l√† thay ƒë·ªïi c√°ch ti·∫øp c·∫≠n. B·∫°n c√≥ th·ªÉ chuy·ªÉn vi·ªác ki·ªÉm tra trang t·ª´ th·ªß c√¥ng (m·∫•t 15 gi√¢y ƒë·ªÉ x√°c nh·∫≠n m·ªôt trang) sang vi·ªác ƒë·ªÉ m√°y t√≠nh l√†m trong _mili gi√¢y_.

ƒê√¢y l√† l√∫c ki·ªÉm th·ª≠ t·ª± ƒë·ªông xu·∫•t hi·ªán. Ki·ªÉm th·ª≠ t·ª± ƒë·ªông cho ph√©p m√°y t√≠nh l√†m ƒëi·ªÅu m√† m√°y t√≠nh gi·ªèi nh·∫•t: th·ª±c hi·ªán c√°c t√°c v·ª• l·∫∑p ƒëi l·∫∑p l·∫°i, nh·∫•t qu√°n v√† nhanh ch√≥ng. Khi ch√∫ng ta vi·∫øt ki·ªÉm th·ª≠, m·ª•c ti√™u l√† x√°c nh·∫≠n m·ªôt logic ho·∫∑c h√†nh vi n√†o ƒë√≥ m·ªôt c√°ch x√°c ƒë·ªãnh.

H√£y xem m·ªôt ki·ªÉm th·ª≠ cho h√†m `add` gi·∫£ ƒë·ªãnh ho·∫°t ƒë·ªông nh∆∞ to√°n t·ª≠ `+`. ƒêi·ªÅu n√†y s·∫Ω gi√∫p b·∫°n h√¨nh dung ki·ªÉm th·ª≠ t·ª± ƒë·ªông l√† g√¨ n·∫øu b·∫°n ch∆∞a t·ª´ng g·∫∑p ki·ªÉm th·ª≠ tr∆∞·ªõc ƒë√¢y.

```python
def test_does_it_add():
    assert add(40, 2) == 42
```

Ki·ªÉm th·ª≠ n√†y ho·∫°t ƒë·ªông b·∫±ng c√°ch ch·∫°y m√£ v√† so s√°nh k·∫øt qu·∫£ v·ªõi gi√° tr·ªã m√† ch√∫ng ta mong ƒë·ª£i. Ki·ªÉm th·ª≠ _kh·∫≥ng ƒë·ªãnh_ r·∫±ng bi·ªÉu th·ª©c so s√°nh l√† ƒë√∫ng. N·∫øu so s√°nh sai, assertion s·∫Ω raise m·ªôt exception v√† ki·ªÉm th·ª≠ th·∫•t b·∫°i.

Ki·ªÉm th·ª≠ t·ª± ƒë·ªông n√†y s·∫Ω m·∫•t g·∫ßn nh∆∞ kh√¥ng ƒë√°ng k·ªÉ th·ªùi gian n·∫øu so v·ªõi vi·ªác ch·∫°y h√†m trong Python REPL ƒë·ªÉ ki·ªÉm tra k·∫øt qu·∫£ th·ªß c√¥ng.

Nh√¨n m·ªôt v√≠ d·ª• ƒë∆°n gi·∫£n v·ªÅ h√†m `add` kh√¥ng gi√∫p b·∫°n nhi·ªÅu v·ªÅ c√°ch ki·ªÉm th·ª≠ d·ª± √°n Django. Ti·∫øp theo, ch√∫ng ta s·∫Ω xem m·ªôt s·ªë lo·∫°i ki·ªÉm th·ª≠ cho Django. N·∫øu b·∫°n th√™m c√°c lo·∫°i ki·ªÉm th·ª≠ n√†y v√†o d·ª± √°n, b·∫°n s·∫Ω t·ª± tin h∆°n khi thay ƒë·ªïi website m√† kh√¥ng lo ph√° v·ª° m·ªçi th·ª©.

## C√°c Lo·∫°i Ki·ªÉm Th·ª≠ Django H·ªØu √çch

Khi ch√∫ng ta t√¨m hi·ªÉu gi·∫£i ph·∫´u m·ªôt ·ª©ng d·ª•ng Django, t√¥i ƒë√£ n√≥i r·∫±ng t√¥i _lu√¥n_ x√≥a file `tests.py` ƒëi k√®m l·ªánh `startapp`. L√Ω do l√† v√¨ c√≥ nhi·ªÅu lo·∫°i ki·ªÉm th·ª≠ kh√°c nhau, v√† t√¥i mu·ªën c√°c lo·∫°i ƒë√≥ n·∫±m ·ªü c√°c file ri√™ng bi·ªát. ·ª®ng d·ª•ng c·ªßa t√¥i s·∫Ω c√≥ c√°c file ri√™ng trong m·ªôt package `tests` b√™n trong app thay v√¨ m·ªôt module `tests.py`.

Package `tests` c·ªßa t√¥i th∆∞·ªùng s·∫Ω ph·∫£n chi·∫øu c·∫•u tr√∫c c·ªßa ch√≠nh ·ª©ng d·ª•ng. Ch∆∞∆°ng tr√¨nh th·ª±c thi ki·ªÉm th·ª≠, g·ªçi l√† ‚Äútest runner‚Äù, th∆∞·ªùng mong ƒë·ª£i t√¨m ki·ªÉm th·ª≠ trong c√°c file b·∫Øt ƒë·∫ßu b·∫±ng `test_`. Package n√†y th∆∞·ªùng bao g·ªìm:

- `test_forms.py`
- `test_models.py`
- `test_views.py`
- v.v.

C·∫•u tr√∫c n√†y g·ª£i √Ω v·ªÅ c√°c lo·∫°i ki·ªÉm th·ª≠ b·∫°n s·∫Ω vi·∫øt cho ·ª©ng d·ª•ng, nh∆∞ng t√¥i s·∫Ω n√≥i c·ª• th·ªÉ h∆°n ·ªü ph·∫ßn sau. Nh√¨n chung, khi vi·∫øt ki·ªÉm th·ª≠ t·ª± ƒë·ªông, c√≥ m·ªôt chi·ªÅu quan tr·ªçng c·∫ßn c√¢n nh·∫Øc: ki·ªÉm th·ª≠ c·ªßa t√¥i n√™n ch·∫°y bao nhi√™u m√£ ngu·ªìn c·ªßa ·ª©ng d·ª•ng?

C√¢u tr·∫£ l·ªùi cho c√¢u h·ªèi ƒë√≥ ·∫£nh h∆∞·ªüng ƒë·∫øn h√†nh vi c·ªßa ki·ªÉm th·ª≠. N·∫øu ch√∫ng ta vi·∫øt m·ªôt ki·ªÉm th·ª≠ ch·∫°y r·∫•t nhi·ªÅu m√£, th√¨ ch√∫ng ta ƒë∆∞·ª£c l·ª£i l√† ki·ªÉm tra ƒë∆∞·ª£c nhi·ªÅu ph·∫ßn c·ªßa h·ªá th·ªëng c√πng l√∫c; tuy nhi√™n, c≈©ng c√≥ m·ªôt s·ªë nh∆∞·ª£c ƒëi·ªÉm:

- Ch·∫°y nhi·ªÅu m√£ nghƒ©a l√† c√≥ nhi·ªÅu th·ª© c√≥ th·ªÉ x·∫£y ra v√† kh·∫£ nƒÉng ki·ªÉm th·ª≠ b·ªã h·ªèng theo nh·ªØng c√°ch kh√¥ng ng·ªù t·ªõi cao h∆°n. M·ªôt ki·ªÉm th·ª≠ th∆∞·ªùng xuy√™n b·ªã h·ªèng b·∫•t ng·ªù ƒë∆∞·ª£c g·ªçi l√† ki·ªÉm th·ª≠ ‚Äúd·ªÖ v·ª°‚Äù (brittle).
- Ch·∫°y nhi·ªÅu m√£ nghƒ©a l√† c√≥ nhi·ªÅu m√£ ph·∫£i th·ª±c thi. ƒêi·ªÅu n√†y nghe hi·ªÉn nhi√™n, nh∆∞ng √Ω nghƒ©a l√† ki·ªÉm th·ª≠ c√†ng nhi·ªÅu m√£ th√¨ c√†ng ch·∫°y l√¢u h∆°n. C√°c ki·ªÉm th·ª≠ t·ª± ƒë·ªông l·ªõn v·∫´n c√≥ th·ªÉ nhanh h∆°n nhi·ªÅu so v·ªõi ki·ªÉm th·ª≠ th·ªß c√¥ng, n√™n th·ªùi gian ch·∫°y ch·ªâ l√† t∆∞∆°ng ƒë·ªëi.

Khi ch√∫ng ta c√≥ c√°c ki·ªÉm th·ª≠ ch·∫°y nhi·ªÅu ph·∫ßn c·ªßa ·ª©ng d·ª•ng _k·∫øt h·ª£p_ v·ªõi nhau, ta g·ªçi ƒë√≥ l√† _integration test_ (ki·ªÉm th·ª≠ t√≠ch h·ª£p). Ki·ªÉm th·ª≠ t√≠ch h·ª£p r·∫•t t·ªët ƒë·ªÉ ph√°t hi·ªán c√°c v·∫•n ƒë·ªÅ li√™n quan ƒë·∫øn _k·∫øt n·ªëi gi·ªØa c√°c ƒëo·∫°n m√£_. V√≠ d·ª•, n·∫øu b·∫°n g·ªçi m·ªôt ph∆∞∆°ng th·ª©c v√† truy·ªÅn sai tham s·ªë, ki·ªÉm th·ª≠ t√≠ch h·ª£p c√≥ th·ªÉ ph√°t hi·ªán ra v·∫•n ƒë·ªÅ ƒë√≥.

·ªû ƒë·∫ßu kia c·ªßa ph·ªï ki·ªÉm th·ª≠ l√† c√°c ki·ªÉm th·ª≠ ch·∫°y r·∫•t √≠t m√£. Ki·ªÉm th·ª≠ `add` ·ªü tr√™n l√† m·ªôt v√≠ d·ª•. C√°c ki·ªÉm th·ª≠ n√†y ki·ªÉm tra t·ª´ng ƒë∆°n v·ªã m√£ ri√™ng l·∫ª (v√≠ d·ª• m·ªôt model Django). V√¨ l√Ω do ƒë√≥, ch√∫ng ta g·ªçi ch√∫ng l√† _unit test_ (ki·ªÉm th·ª≠ ƒë∆°n v·ªã). Unit test r·∫•t t·ªët ƒë·ªÉ _ki·ªÉm tra m·ªôt ƒëo·∫°n m√£ ri√™ng bi·ªát_ nh·∫±m x√°c nh·∫≠n h√†nh vi c·ªßa n√≥.

Unit test c≈©ng c√≥ nh∆∞·ª£c ƒëi·ªÉm. C√°c ki·ªÉm th·ª≠ n√†y ch·∫°y m√† kh√¥ng c√≥ nhi·ªÅu ng·ªØ c·∫£nh t·ª´ ph·∫ßn c√≤n l·∫°i c·ªßa ·ª©ng d·ª•ng. ƒêi·ªÅu n√†y gi√∫p b·∫°n x√°c nh·∫≠n h√†nh vi c·ªßa t·ª´ng ph·∫ßn, nh∆∞ng c√≥ th·ªÉ kh√¥ng ph·∫£i l√† h√†nh vi m√† to√†n b·ªô ·ª©ng d·ª•ng y√™u c·∫ßu.

B√†i h·ªçc ·ªü ƒë√¢y l√† c·∫£ hai lo·∫°i ki·ªÉm th·ª≠ ƒë·ªÅu t·ªët, nh∆∞ng ƒë·ªÅu c√≥ ƒë√°nh ƒë·ªïi. H√£y c·∫©n th·∫≠n v·ªõi ai ƒë√≥ n√≥i r·∫±ng b·∫°n ch·ªâ n√™n vi·∫øt m·ªôt lo·∫°i ki·ªÉm th·ª≠ n√†y ho·∫∑c lo·∫°i kia.

> _M·ªôt b·ªô ki·ªÉm th·ª≠ t·ª± ƒë·ªông t·ªët s·∫Ω bao g·ªìm c·∫£ ki·ªÉm th·ª≠ **ƒë∆°n v·ªã** v√† **t√≠ch h·ª£p** ƒë·ªÉ ki·ªÉm tra h√†nh vi c·ªßa t·ª´ng ph·∫ßn ri√™ng l·∫ª v√† s·ª± k·∫øt n·ªëi gi·ªØa c√°c ph·∫ßn._

Ch√∫ng ta c·∫ßn c√¢n nh·∫Øc th√™m m·ªôt kh√≠a c·∫°nh n·ªØa: ƒë√¢u l√† ‚Äúl∆∞·ª£ng m√£ ƒë√∫ng‚Äù cho m·ªôt unit test? _Kh√¥ng c√≥ c√¢u tr·∫£ l·ªùi tuy·ªát ƒë·ªëi ·ªü ƒë√¢y._ Th·ª±c t·∫ø, ch·ªß ƒë·ªÅ n√†y ƒë∆∞·ª£c tranh lu·∫≠n r·∫•t nhi·ªÅu gi·ªØa c√°c tester.

M·ªôt s·ªë ng∆∞·ªùi cho r·∫±ng unit test ch·ªâ n√™n ch·∫°y m√£ c·ªßa ƒë∆°n v·ªã ƒë√≥. N·∫øu b·∫°n c√≥ m·ªôt class ch·ªâ th·ª±c hi·ªán logic thu·∫ßn t√∫y v√† kh√¥ng c·∫ßn m√£ kh√°c, th√¨ b·∫°n ƒëang ·ªü tr∆∞·ªùng h·ª£p l√Ω t∆∞·ªüng. Nh∆∞ng n·∫øu b·∫°n ki·ªÉm th·ª≠ m·ªôt ph∆∞∆°ng th·ª©c b·∫°n th√™m v√†o model Django v√† n√≥ c·∫ßn t∆∞∆°ng t√°c v·ªõi c∆° s·ªü d·ªØ li·ªáu th√¨ sao? Ngay c·∫£ khi b·∫°n ch·ªâ ki·ªÉm tra ph∆∞∆°ng th·ª©c model ri√™ng l·∫ª, m·ªôt ng∆∞·ªùi theo ch·ªß nghƒ©a unit test s·∫Ω cho r·∫±ng ki·ªÉm th·ª≠ ƒë√≥ th·ª±c ra l√† integration test n·∫øu n√≥ t∆∞∆°ng t√°c v·ªõi c∆° s·ªü d·ªØ li·ªáu.

**T√¥i th∆∞·ªùng th·∫•y ki·ªÉu tranh lu·∫≠n n√†y kh√¥ng hi·ªáu qu·∫£.** Theo kinh nghi·ªám c·ªßa t√¥i, tranh lu·∫≠n tri·∫øt l√Ω v·ªÅ unit test l√† g√¨ th∆∞·ªùng kh√¥ng gi√∫p √≠ch cho vi·ªác ki·ªÉm th·ª≠ web app ƒë·ªÉ x√°c nh·∫≠n t√≠nh ƒë√∫ng ƒë·∫Øn. T√¥i ƒë·ªÅ c·∫≠p ƒë·∫øn ƒëi·ªÅu n√†y v√¨ n·∫øu b·∫°n mu·ªën t√¨m hi·ªÉu s√¢u h∆°n v·ªÅ ki·ªÉm th·ª≠ sau b√†i n√†y, t√¥i khuy√™n b·∫°n tr√°nh b·ªã cu·ªën v√†o b·∫´y ƒë·ªãnh nghƒ©a n√†y.

ƒê√¢y l√† ƒë·ªãnh nghƒ©a th·ª±c t·∫ø c·ªßa t√¥i v·ªÅ unit test v√† integration test trong Django. C√°c ƒë·ªãnh nghƒ©a n√†y kh√¥ng ho√†n h·∫£o (nh∆∞ _m·ªçi_ ƒë·ªãnh nghƒ©a), nh∆∞ng ch√∫ng s·∫Ω gi√∫p b·∫°n h√¨nh dung ch·ªß ƒë·ªÅ trong b√†i vi·∫øt n√†y.

- **Unit test** - Ki·ªÉm th·ª≠ ki·ªÉm tra t·ª´ng ƒë∆°n v·ªã ri√™ng l·∫ª trong d·ª± √°n Django nh∆∞ m·ªôt ph∆∞∆°ng th·ª©c model ho·∫∑c m·ªôt form.
- **Integration test** - Ki·ªÉm th·ª≠ ki·ªÉm tra m·ªôt nh√≥m c√°c ƒë∆°n v·ªã v√† s·ª± t∆∞∆°ng t√°c gi·ªØa ch√∫ng, v√≠ d·ª• ki·ªÉm tra m·ªôt view render ra k·∫øt qu·∫£ mong ƒë·ª£i.

Gi·ªù ch√∫ng ta ƒë√£ c√≥ kh√°i ni·ªám c·ªët l√µi v·ªÅ ki·ªÉm th·ª≠, h√£y ƒëi v√†o chi ti·∫øt.

### Unit Test

Khi ƒëi v√†o v√≠ d·ª•, t√¥i c·∫ßn gi·ªõi thi·ªáu m·ªôt v√†i c√¥ng c·ª• m√† t√¥i d√πng cho t·∫•t c·∫£ d·ª± √°n Django c·ªßa m√¨nh. T√¥i s·∫Ω m√¥ t·∫£ k·ªπ h∆°n v·ªÅ c√°c c√¥ng c·ª• n√†y ·ªü ph·∫ßn sau, nh∆∞ng c·∫ßn gi·ªõi thi·ªáu ng·∫Øn g·ªçn ·ªü ƒë√¢y ƒë·ªÉ v√≠ d·ª• kh√¥ng b·ªã kh√≥ hi·ªÉu. Hai package ‚Äúph·∫£i c√≥‚Äù c·ªßa t√¥i l√†:

- `pytest-django`
- `factory-boy`

`pytest-django` l√† m·ªôt package gi√∫p ch·∫°y ki·ªÉm th·ª≠ Django th√¥ng qua ch∆∞∆°ng tr√¨nh `pytest`. pytest l√† m·ªôt c√¥ng c·ª• ki·ªÉm th·ª≠ Python c·ª±c k·ª≥ ph·ªï bi·∫øn v·ªõi h·ªá sinh th√°i extension r·∫•t l·ªõn. Th·ª±c t·∫ø, `pytest-django` l√† m·ªôt trong nh·ªØng extension ƒë√≥.

L√Ω do l·ªõn nh·∫•t t√¥i d√πng `pytest-django` l√† n√≥ cho ph√©p t√¥i d√πng t·ª´ kh√≥a `assert` trong t·∫•t c·∫£ ki·ªÉm th·ª≠. Trong module `unittest` c·ªßa th∆∞ vi·ªán chu·∫©n Python v√†, k√©o theo ƒë√≥, c√°c c√¥ng c·ª• ki·ªÉm th·ª≠ t√≠ch h·ª£p c·ªßa Django (subclass t·ª´ c√°c class c·ªßa `unittest`), vi·ªác ki·ªÉm tra gi√° tr·ªã c·∫ßn c√°c ph∆∞∆°ng th·ª©c nh∆∞ `assertEqual` v√† `assertTrue`. Nh∆∞ b·∫°n s·∫Ω th·∫•y, ch·ªâ d√πng t·ª´ kh√≥a `assert` l√† c√°ch vi·∫øt ki·ªÉm th·ª≠ r·∫•t t·ª± nhi√™n.

C√¥ng c·ª• quan tr·ªçng c√≤n l·∫°i l√† `factory-boy`. Tr√™n PyPI g·ªçi l√† `factory-boy`, nh∆∞ng t√†i li·ªáu l·∫°i d√πng `factory_boy`, n√™n t·ª´ ƒë√¢y t√¥i s·∫Ω d√πng t√™n ƒë√≥. `factory_boy` l√† c√¥ng c·ª• ƒë·ªÉ x√¢y d·ª±ng d·ªØ li·ªáu ki·ªÉm th·ª≠ cho c∆° s·ªü d·ªØ li·ªáu. Th∆∞ vi·ªán n√†y t√≠ch h·ª£p tuy·ªát v·ªùi v·ªõi Django v√† gi√∫p ch√∫ng ta sinh d·ªØ li·ªáu model r·∫•t d·ªÖ d√†ng.

T√¥i s·∫Ω t·∫≠p trung v√†o hai package n√†y ·ªü ph·∫ßn sau ƒë·ªÉ n√≥i k·ªπ h∆°n v·ªÅ t√≠nh nƒÉng, nh∆∞ng b·∫°n s·∫Ω th·∫•y ch√∫ng ƒë∆∞·ª£c d√πng ngay trong c√°c v√≠ d·ª•.

#### Ki·ªÉm Th·ª≠ Model

Trong c√°c d·ª± √°n Django, ch√∫ng ta d√πng model ƒë·ªÉ l∆∞u d·ªØ li·ªáu v·ªÅ ·ª©ng d·ª•ng, n√™n r·∫•t t·ª± nhi√™n khi th√™m c√°c ph∆∞∆°ng th·ª©c v√†o model ƒë·ªÉ thao t√°c v·ªõi d·ªØ li·ªáu. L√†m sao ƒë·ªÉ vi·∫øt ki·ªÉm th·ª≠ x√°c nh·∫≠n ph∆∞∆°ng th·ª©c ƒë√≥ ho·∫°t ƒë·ªông nh∆∞ mong ƒë·ª£i?

T√¥i s·∫Ω ƒë∆∞a cho b·∫°n m·ªôt khung t∆∞ duy cho _m·ªçi_ ki·ªÉm th·ª≠, kh√¥ng ch·ªâ unit test. Khung n√†y s·∫Ω gi√∫p b·∫°n suy nghƒ© v·ªÅ m·ªçi ki·ªÉm th·ª≠ khi ƒë·ªçc v√† vi·∫øt m√£. ƒê√≥ l√† _m·∫´u AAA_. AAA l√† vi·∫øt t·∫Øt c·ªßa:

- **Arrange** - Ph·∫ßn n√†y c·ªßa ki·ªÉm th·ª≠ s·∫Ω thi·∫øt l·∫≠p d·ªØ li·ªáu v√† c√°c ƒëi·ªÅu ki·ªán c·∫ßn thi·∫øt cho ki·ªÉm th·ª≠.
- **Act** - Giai ƒëo·∫°n n√†y l√† khi ki·ªÉm th·ª≠ ch·∫°y ƒëo·∫°n m√£ ·ª©ng d·ª•ng b·∫°n mu·ªën ki·ªÉm tra.
- **Assert** - Ph·∫ßn cu·ªëi c√πng ki·ªÉm tra r·∫±ng h√†nh ƒë·ªông c·ªßa b·∫°n ƒë√∫ng nh∆∞ mong ƒë·ª£i.

V·ªõi ki·ªÉm th·ª≠ model, n√≥ s·∫Ω tr√¥ng nh∆∞ sau:

```python
# application/tests/test_models.py

from application.models import Order
from application.tests.factories import OrderFactory

class TestOrder:
    def test_shipped(self):
        """After shipping an order, the status is shipped."""
        order = OrderFactory(
            status=Order.Status.PENDING
        )

        order.ship()

        order.refresh_from_db()
        assert order.status == Order.Status.SHIPPED
```

Ch√∫ng ta c√≥ th·ªÉ h√¨nh dung m·ªôt d·ª± √°n c√≥ h·ªá th·ªëng th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠. M·ªôt ph·∫ßn l·ªõn c·ªßa vi·ªác x·ª≠ l√Ω ƒë∆°n h√†ng l√† theo d√µi tr·∫°ng th√°i. Ch√∫ng ta c√≥ th·ªÉ t·ª± ƒë·∫∑t tr∆∞·ªùng tr·∫°ng th√°i ·ªü nhi·ªÅu n∆°i trong ·ª©ng d·ª•ng, nh∆∞ng thay ƒë·ªïi tr·∫°ng th√°i trong m·ªôt ph∆∞∆°ng th·ª©c cho ph√©p ta l√†m th√™m vi·ªác kh√°c. V√≠ d·ª•, c√≥ th·ªÉ ph∆∞∆°ng th·ª©c `ship` c≈©ng g·ª≠i email.

Trong ki·ªÉm th·ª≠ tr√™n, ch√∫ng ta ki·ªÉm tra chuy·ªÉn tr·∫°ng th√°i t·ª´ `PENDING` sang `SHIPPED`. Ki·ªÉm th·ª≠ g·ªçi ph∆∞∆°ng th·ª©c `ship`, sau ƒë√≥ l√†m m·ªõi instance model t·ª´ c∆° s·ªü d·ªØ li·ªáu ƒë·ªÉ ƒë·∫£m b·∫£o tr·∫°ng th√°i `SHIPPED` ƒë√£ ƒë∆∞·ª£c l∆∞u.

ƒêi·ªÅu g√¨ t·ªët ·ªü ki·ªÉm th·ª≠ n√†y?

Ki·ªÉm th·ª≠ c√≥ docstring. Tin t√¥i ƒëi, b·∫°n _s·∫Ω_ th·∫•y l·ª£i √≠ch c·ªßa docstring cho ki·ªÉm th·ª≠. C√≥ m·ªôt c√°m d·ªó l·ªõn l√† ch·ªâ ƒë·ªÉ l·∫°i t√™n h√†m nh∆∞ `test_shipped`, nh∆∞ng sau n√†y b·∫°n c√≥ th·ªÉ kh√¥ng c√≤n ƒë·ªß ng·ªØ c·∫£nh.

Nhi·ªÅu l·∫≠p tr√¨nh vi√™n ch·ªçn t√™n ki·ªÉm th·ª≠ d√†i thay th·∫ø. T√¥i kh√¥ng ph·∫£n ƒë·ªëi t√™n ki·ªÉm th·ª≠ d√†i, nh∆∞ng docstring c≈©ng r·∫•t h·ªØu √≠ch. Whitespace l√† _t·ªët_ v√†, theo t√¥i, d·ªÖ ƒë·ªçc ‚ÄúThe widget updates the game state when pushed.‚Äù h∆°n l√† `test_widget_updates_game_state_when_pushed`.

Ki·ªÉm th·ª≠ ki·ªÉm tra m·ªôt h√†nh ƒë·ªông duy nh·∫•t. M·ªôt ki·ªÉm th·ª≠ ki·ªÉm tra m·ªôt h√†nh ƒë·ªông duy nh·∫•t s·∫Ω d·ªÖ hi·ªÉu. Kh√¥ng c√≥ c√¢u h·ªèi v·ªÅ s·ª± t∆∞∆°ng t√°c v·ªõi ph·∫ßn kh√°c. C≈©ng kh√¥ng c√≥ c√¢u h·ªèi v·ªÅ vi·ªác th·ª±c s·ª± ƒëang ki·ªÉm tra c√°i g√¨. S·ª± ƒë∆°n gi·∫£n c·ªßa vi·ªác ki·ªÉm tra m·ªôt h√†nh ƒë·ªông gi√∫p m·ªói unit test k·ªÉ m·ªôt c√¢u chuy·ªán ri√™ng.

Ng∆∞·ª£c l·∫°i, b·∫°n c√≥ th·ªÉ g·∫∑p c√°c ki·ªÉm th·ª≠ trong d·ª± √°n l√†m r·∫•t nhi·ªÅu b∆∞·ªõc chu·∫©n b·ªã, r·ªìi xen k·∫Ω gi·ªØa act v√† assert trong m·ªôt ki·ªÉm th·ª≠. C√°c ki·ªÉm th·ª≠ n√†y d·ªÖ v·ª° (t·ª©c l√† d·ªÖ b·ªã h·ªèng v√† fail) v√† kh√≥ hi·ªÉu khi c√≥ l·ªói.

C√°c ƒë·∫∑c ƒëi·ªÉm n√†y √°p d·ª•ng cho nhi·ªÅu lo·∫°i ki·ªÉm th·ª≠ kh√°c nhau. ƒê√≥ l√† c√°i hay c·ªßa m·ªôt m√¥ h√¨nh t∆∞ duy ki·ªÉm th·ª≠ v·ªØng ch·∫Øc. Khi b·∫°n th·∫•y ki·ªÉm th·ª≠:

1. Thi·∫øt l·∫≠p ƒë·∫ßu v√†o,
2. Th·ª±c hi·ªán h√†nh ƒë·ªông,
3. Ki·ªÉm tra ƒë·∫ßu ra,

th√¨ ki·ªÉm th·ª≠ t·ª± ƒë·ªông s·∫Ω b·ªõt ƒë√°ng s·ª£ v√† h·ªØu √≠ch h∆°n nhi·ªÅu. Gi·ªù h√£y xem m·∫´u n√†y √°p d·ª•ng cho form nh∆∞ th·∫ø n√†o.

#### Ki·ªÉm Th·ª≠ Form

Khi vi·∫øt ki·ªÉm th·ª≠, ch√∫ng ta th∆∞·ªùng mu·ªën vi·∫øt ki·ªÉm th·ª≠ ‚Äúhappy path‚Äù. ƒê√¢y l√† lo·∫°i ki·ªÉm th·ª≠ khi m·ªçi th·ª© ho·∫°t ƒë·ªông ƒë√∫ng nh∆∞ mong ƒë·ª£i. ƒê√¢y l√† m·ªôt ki·ªÉm th·ª≠ happy path cho form.

```python
# application/tests/test_forms.py

from application.forms import SupportForm
from application.models import SupportRequest

class TestSupportForm:
    def test_request_created(self):
        """A submission to the support form creates a support request."""
        email = "hello@notreal.com"
        data = {
            "email": email,
            "message": "I'm having trouble with your product."
        }
        form = SupportForm(data=data)
        form.is_valid()

        form.save()

        assert SupportRequest.objects.filter(
            email=email
        ).count() == 1
```

V·ªõi ki·ªÉm th·ª≠ n√†y, ch√∫ng ta m√¥ ph·ªèng m·ªôt request POST. Ki·ªÉm th·ª≠:

- T·∫°o d·ªØ li·ªáu POST l√† `data`
- T·∫°o m·ªôt form ƒë√£ g√°n d·ªØ li·ªáu (t·ª©c l√† truy·ªÅn `data=data` v√†o constructor)
- Ki·ªÉm tra t√≠nh h·ª£p l·ªá c·ªßa form
- L∆∞u form
- Kh·∫≥ng ƒë·ªãnh r·∫±ng ƒë√£ t·∫°o m·ªôt b·∫£n ghi m·ªõi

L∆∞u √Ω l√† t√¥i h∆°i ‚Äúb·∫ª cong‚Äù quy t·∫Øc AAA m·ªôt ch√∫t cho ki·ªÉm th·ª≠ n√†y. Theo th√¥ng l·ªá c·ªßa Django v·ªõi form, form ph·∫£i h·ª£p l·ªá tr∆∞·ªõc khi g·ªçi ph∆∞∆°ng th·ª©c `save`. N·∫øu kh√¥ng l√†m v·∫≠y, `cleaned_data` s·∫Ω kh√¥ng ƒë∆∞·ª£c populate ƒë√∫ng v√† h·∫ßu h·∫øt c√°c ph∆∞∆°ng th·ª©c `save` ƒë·ªÅu ph·ª• thu·ªôc v√†o `cleaned_data`. D√π `is_valid` l√† m·ªôt h√†nh ƒë·ªông, t√¥i xem n√≥ l√† b∆∞·ªõc chu·∫©n b·ªã cho ki·ªÉm th·ª≠ form.

Khi l√†m vi·ªác v·ªõi form, ƒëi·ªÅu ch√∫ng ta quan t√¢m l√† l√†m s·∫°ch d·ªØ li·ªáu ƒë·ªÉ ƒë·∫£m b·∫£o d·ªØ li·ªáu r√°c kh√¥ng v√†o c∆° s·ªü d·ªØ li·ªáu. H√£y vi·∫øt m·ªôt ki·ªÉm th·ª≠ cho form kh√¥ng h·ª£p l·ªá.

```python
# application/tests/test_forms.py

from application.forms import SupportForm
from application.models import SupportRequest

class TestSupportForm:
    # ... def test_request_created ...

    def test_bad_email(self):
        """An malformed email address is invalid."""
        data = {
            "email": "bogus",
            "message": "Whatever"
        }
        form = SupportForm(data=data)

        is_valid = form.is_valid()

        assert not is_valid
        assert 'email' in form.errors
```

Ki·ªÉm th·ª≠ n√†y cho th·∫•y c√°ch ki·ªÉm tra m·ªôt form kh√¥ng h·ª£p l·ªá. C√°c b∆∞·ªõc ch√≠nh l√†:

- Thi·∫øt l·∫≠p d·ªØ li·ªáu form sai
- Ki·ªÉm tra t√≠nh h·ª£p l·ªá v·ªõi `is_valid`
- Ki·ªÉm tra tr·∫°ng th√°i ƒë·∫ßu ra trong `form.errors`

Ki·ªÉm th·ª≠ n√†y cho th·∫•y c√°ch ki·ªÉm tra form kh√¥ng h·ª£p l·ªá, nh∆∞ng t√¥i √≠t khi vi·∫øt ki·ªÉm th·ª≠ n√†y trong d·ª± √°n th·ª±c t·∫ø. T·∫°i sao? V√¨ ki·ªÉm th·ª≠ n√†y ki·ªÉm tra ch·ª©c nƒÉng c·ªßa `EmailField` c·ªßa Django, v·ªën ƒë√£ c√≥ logic ki·ªÉm tra email h·ª£p l·ªá.

N√≥i chung, t√¥i kh√¥ng nghƒ© ki·ªÉm th·ª≠ c√°c t√≠nh nƒÉng c·ªßa framework l√† h·ªØu √≠ch. M·ªôt d·ª± √°n m√£ ngu·ªìn m·ªü t·ªët nh∆∞ Django ƒë√£ ki·ªÉm th·ª≠ c√°c t√≠nh nƒÉng ƒë√≥ cho b·∫°n. Khi vi·∫øt ki·ªÉm th·ª≠ form, b·∫°n n√™n ki·ªÉm tra c√°c ph∆∞∆°ng th·ª©c `clean_*` v√† `clean` t√πy bi·∫øn c≈©ng nh∆∞ b·∫•t k·ª≥ ph∆∞∆°ng th·ª©c `save` t√πy bi·∫øn n√†o b·∫°n th√™m v√†o.

M·∫´u ki·ªÉm th·ª≠ cho c·∫£ happy path v√† tr∆∞·ªùng h·ª£p l·ªói l√† th·ª© t√¥i d√πng cho h·∫ßu h·∫øt ki·ªÉm th·ª≠ form Django. H√£y chuy·ªÉn sang ki·ªÉm th·ª≠ t√≠ch h·ª£p ƒë·ªÉ xem ki·ªÉm th·ª≠ nhi·ªÅu m√£ h∆°n tr√¥ng nh∆∞ th·∫ø n√†o.

### Ki·ªÉm Th·ª≠ T√≠ch H·ª£p

Theo t√¥i, m·ªôt ki·ªÉm th·ª≠ t√≠ch h·ª£p t·ªët s·∫Ω kh√¥ng kh√°c nhi·ªÅu so v·ªõi m·ªôt unit test t·ªët. Ki·ªÉm th·ª≠ t√≠ch h·ª£p v·∫´n c√≥ th·ªÉ tu√¢n theo m·∫´u AAA nh∆∞ c√°c ki·ªÉm th·ª≠ t·ª± ƒë·ªông kh√°c. ƒêi·ªÅu thay ƒë·ªïi l√† c√¥ng c·ª• b·∫°n d√πng v√† c√°c kh·∫≥ng ƒë·ªãnh b·∫°n s·∫Ω vi·∫øt.

ƒê·ªãnh nghƒ©a c·ªßa t√¥i v·ªÅ ki·ªÉm th·ª≠ t√≠ch h·ª£p trong Django l√† ki·ªÉm th·ª≠ d√πng test `Client` c·ªßa Django. Trong c√°c b√†i tr∆∞·ªõc, t√¥i ch·ªâ nh·∫Øc ƒë·∫øn client m·ªôt c√°ch l∆∞·ªõt qua. Trong ng·ªØ c·∫£nh ·ª©ng d·ª•ng web, client l√† b·∫•t c·ª© th·ª© g√¨ ti√™u th·ª• ƒë·∫ßu ra c·ªßa web app ƒë·ªÉ hi·ªÉn th·ªã cho ng∆∞·ªùi d√πng.

Client r√µ r√†ng nh·∫•t cho web app l√† tr√¨nh duy·ªát, nh∆∞ng c√≤n r·∫•t nhi·ªÅu lo·∫°i client kh√°c. M·ªôt s·ªë v√≠ d·ª• c√≥ th·ªÉ d√πng ƒë·∫ßu ra t·ª´ web app:

- ·ª®ng d·ª•ng di ƒë·ªông native
- Giao di·ªán d√≤ng l·ªánh
- Th∆∞ vi·ªán l·∫≠p tr√¨nh nh∆∞ package `requests` c·ªßa Python c√≥ th·ªÉ x·ª≠ l√Ω HTTP request v√† response

Test `Client` c·ªßa Django c≈©ng gi·ªëng c√°c client kh√°c ·ªü ch·ªó n√≥ c√≥ th·ªÉ t∆∞∆°ng t√°c v·ªõi d·ª± √°n Django ƒë·ªÉ nh·∫≠n d·ªØ li·ªáu t·ª´ c√°c request m√† n√≥ t·∫°o ra. ƒêi·ªÉm hay c·ªßa test client l√† ƒë·∫ßu ra ƒë∆∞·ª£c tr·∫£ v·ªÅ theo c√°ch ti·ªán l·ª£i ƒë·ªÉ ch√∫ng ta ki·ªÉm tra. Client tr·∫£ v·ªÅ tr·ª±c ti·∫øp object `HttpResponse`!

V·ªõi b·ªëi c·∫£nh ƒë√≥, ƒë√¢y l√† m·ªôt ki·ªÉm th·ª≠ t√≠ch h·ª£p ƒë·ªÉ ch√∫ng ta th·∫£o lu·∫≠n.

```python
# application/tests/test_views.py

from django.test import Client
from django.urls import reverse

from application.tests.factories import UserFactory

class TestProfileView:
    def test_shows_name(self):
        """The profile view shows the user's name."""
        client = Client()
        user = UserFactory()

        response = client.get(
            reverse("profile")
        )

        assert response.status_code == 200
        assert user.first_name in response.content.decode()
```

Ki·ªÉm th·ª≠ n√†y ƒëang l√†m g√¨? V√† ki·ªÉm th·ª≠ n√†y _kh√¥ng_ l√†m g√¨?

B·∫±ng c√°ch d√πng test client c·ªßa Django, ki·ªÉm th·ª≠ n√†y ch·∫°y r·∫•t nhi·ªÅu m√£ Django. N√≥ ƒëi qua:

- ƒê·ªãnh tuy·∫øn URL
- Th·ª±c thi view (c√≥ th·ªÉ s·∫Ω truy v·∫•n c∆° s·ªü d·ªØ li·ªáu)
- Render template

ƒê√≥ l√† r·∫•t nhi·ªÅu m√£ ƒë∆∞·ª£c ch·∫°y trong m·ªôt ki·ªÉm th·ª≠! M·ª•c ti√™u c·ªßa ki·ªÉm th·ª≠ l√† ki·ªÉm tra t·∫•t c·∫£ c√°c ph·∫ßn ch√≠nh c√≥ k·∫øt n·ªëi v·ªõi nhau.

Gi·ªù h√£y xem ki·ªÉm th·ª≠ _kh√¥ng_ l√†m g√¨. D√π ki·ªÉm th·ª≠ ch·∫°y r·∫•t nhi·ªÅu m√£, kh√¥ng c√≥ qu√° nhi·ªÅu c√¢u l·ªánh `assert`. N√≥i c√°ch kh√°c, m·ª•c ti√™u c·ªßa ki·ªÉm th·ª≠ t√≠ch h·ª£p kh√¥ng ph·∫£i l√† ki·ªÉm tra t·ª´ng chi ti·∫øt nh·ªè c√≥ th·ªÉ x·∫£y ra trong to√†n b·ªô lu·ªìng. Hy v·ªçng r·∫±ng ch√∫ng ta ƒë√£ c√≥ unit test ki·ªÉm tra c√°c ph·∫ßn nh·ªè ƒë√≥.

Khi t√¥i vi·∫øt ki·ªÉm th·ª≠ t√≠ch h·ª£p, t√¥i ch·ªß y·∫øu mu·ªën tr·∫£ l·ªùi c√¢u h·ªèi: **h·ªá th·ªëng c√≥ ho·∫°t ƒë·ªông tr∆°n tru m√† kh√¥ng b·ªã v·ª° kh√¥ng?**

Gi·ªù ch√∫ng ta ƒë√£ b√†n v·ªÅ unit test v√† integration test, v·∫≠y c√≥ nh·ªØng c√¥ng c·ª• n√†o gi√∫p ki·ªÉm th·ª≠ d·ªÖ d√†ng h∆°n?

## C√¥ng C·ª• H·ªó Tr·ª£

Khi ki·ªÉm th·ª≠ ·ª©ng d·ª•ng, b·∫°n c√≥ r·∫•t nhi·ªÅu package h·ªó tr·ª£ ƒë·∫øn m·ª©c c√≥ th·ªÉ b·ªã cho√°ng ng·ª£p. N·∫øu b·∫°n ki·ªÉm th·ª≠ l·∫ßn ƒë·∫ßu, b·∫°n c√≥ th·ªÉ g·∫∑p kh√≥ khƒÉn khi √°p d·ª•ng m·∫´u AAA v√† bi·∫øt n√™n ki·ªÉm th·ª≠ g√¨. Ch√∫ng ta mu·ªën gi·∫£m thi·ªÉu nh·ªØng th·ª© b·∫°n ph·∫£i bi·∫øt th√™m.

Ch√∫ng ta s·∫Ω xem l·∫°i hai c√¥ng c·ª• t√¥i ƒë√£ li·ªát k√™ ·ªü tr√™n, `pytest-django` v√† `factory_boy`, ƒë·ªÉ b·∫°n b·∫Øt ƒë·∫ßu. H√£y coi ƒë√¢y l√† b·ªô sinh t·ªìn ki·ªÉm th·ª≠ Django c·ªßa b·∫°n. Khi k·ªπ nƒÉng ki·ªÉm th·ª≠ ph√°t tri·ªÉn, b·∫°n c√≥ th·ªÉ th√™m nhi·ªÅu c√¥ng c·ª• kh√°c, nh∆∞ng hai c√¥ng c·ª• n√†y l√† kh·ªüi ƒë·∫ßu tuy·ªát v·ªùi.

### `pytest-django`

[pytest](https://docs.pytest.org/en/stable/) l√† m·ªôt ‚Äútest runner‚Äù. C√¥ng c·ª• n√†y d√πng ƒë·ªÉ ch·∫°y ki·ªÉm th·ª≠ t·ª± ƒë·ªông. N·∫øu b·∫°n ƒë·ªçc [Writing and running tests](https://docs.djangoproject.com/en/4.1/topics/testing/overview/) trong t√†i li·ªáu Django, b·∫°n s·∫Ω th·∫•y Django _c≈©ng_ c√≥ m·ªôt test runner v·ªõi `./manage.py test`. V·∫≠y t·∫°i sao t√¥i l·∫°i khuy√™n b·∫°n d√πng `pytest`?

T√¥i s·∫Ω m·∫°nh d·∫°n kh·∫≥ng ƒë·ªãnh: **pytest t·ªët h∆°n**. (T√¥i v·ª´a meta ƒë·∫•y! üòÜ)

T√¥i th√≠ch nhi·ªÅu th·ª© ·ªü test runner t√≠ch h·ª£p c·ªßa Django, nh∆∞ng t√¥i lu√¥n quay l·∫°i v·ªõi pytest v√¨ m·ªôt l√Ω do ch√≠nh: t√¥i c√≥ th·ªÉ d√πng `assert` trong ki·ªÉm th·ª≠. Nh∆∞ b·∫°n ƒë√£ th·∫•y trong c√°c v√≠ d·ª•, t·ª´ kh√≥a `assert` gi√∫p m√£ ki·ªÉm th·ª≠ d·ªÖ ƒë·ªçc. Ch√∫ng ta c√≥ th·ªÉ d√πng t·∫•t c·∫£ ph√©p so s√°nh th√¥ng th∆∞·ªùng c·ªßa Python (v√≠ d·ª• `==`, `!=`, `in`) ƒë·ªÉ ki·ªÉm tra ƒë·∫ßu ra c·ªßa ki·ªÉm th·ª≠.

Test runner c·ªßa Django x√¢y d·ª±ng d·ª±a tr√™n c√¥ng c·ª• ki·ªÉm th·ª≠ c√≥ s·∫µn trong Python l√† module `unittest`. V·ªõi c√°c c√¥ng c·ª• ƒë√≥, l·∫≠p tr√¨nh vi√™n ph·∫£i t·∫°o class ki·ªÉm th·ª≠ k·∫ø th·ª´a t·ª´ `unittest.TestCase`. Nh∆∞·ª£c ƒëi·ªÉm c·ªßa class `TestCase` l√† b·∫°n ph·∫£i d√πng m·ªôt lo·∫°t ph∆∞∆°ng th·ª©c `assert*` ƒë·ªÉ ki·ªÉm tra m√£.

Danh s√°ch c√°c ph∆∞∆°ng th·ª©c `assert*` c√≥ trong t√†i li·ªáu [unittest](https://docs.python.org/3/library/unittest.html#assert-methods). B·∫°n c√≥ th·ªÉ th√†nh c√¥ng v·ªõi c√°c ph∆∞∆°ng th·ª©c n√†y, nh∆∞ng t√¥i nghƒ© n√≥ ƒë√≤i h·ªèi ph·∫£i nh·ªõ m·ªôt API v·ªõi r·∫•t nhi·ªÅu ph∆∞∆°ng th·ª©c. H√£y c√¢n nh·∫Øc ƒëi·ªÅu n√†y. B·∫°n th√≠ch:

1. D√πng `assert`? HAY
2. D√πng `assertEqual`, `assertNotEqual`, `assertTrue`, `assertFalse`, `assertIs`, `assertIsNot`, `assertIsNone`, `assertIsNotNone`, `assertIn`, `assertNotIn`, `assertIsInstance`, v√† `assertNotIsInstance`?

D√πng `assert` t·ª´ pytest nghƒ©a l√† b·∫°n c√≥ t·∫•t c·∫£ l·ª£i √≠ch c·ªßa c√°c ph∆∞∆°ng th·ª©c `assert*`, nh∆∞ng ch·ªâ c·∫ßn nh·ªõ m·ªôt t·ª´ kh√≥a duy nh·∫•t. N·∫øu v·∫≠y v·∫´n ch∆∞a ƒë·ªß, h√£y so s√°nh ƒë·ªô d·ªÖ ƒë·ªçc:

```python
self.assertEqual(my_value, 42)
assert my_value == 42

self.assertNotEqual(my_value, 42)
assert my_value != 42

self.assertIsNotNone(my_value)
assert my_value is not None

self.assertTrue(my_value)
assert my_value
```

V√¨ l√Ω do t∆∞∆°ng t·ª± m√† l·∫≠p tr√¨nh vi√™n Python th√≠ch d√πng ph∆∞∆°ng th·ª©c `property` thay v√¨ getter v√† setter (v√≠ d·ª• `obj.value = 42` thay v√¨ `obj.set_value(42)`), t√¥i nghƒ© c√∫ ph√°p ki·ªÉu `assert` ƒë∆°n gi·∫£n h∆°n nhi·ªÅu ƒë·ªÉ ƒë·ªçc.

Ngo√†i vi·ªác x·ª≠ l√Ω tuy·ªát v·ªùi t·ª´ kh√≥a `assert`, [pytest-django](https://pytest-django.readthedocs.io/en/latest/) c√≤n c√≥ nhi·ªÅu t√≠nh nƒÉng kh√°c m√† b·∫°n c√≥ th·ªÉ th·∫•y h·ªØu √≠ch khi vi·∫øt ki·ªÉm th·ª≠ t·ª± ƒë·ªông.

### `factory_boy`

Package ki·ªÉm th·ª≠ kh√°c m√† t√¥i nghƒ© m·ªçi l·∫≠p tr√¨nh vi√™n n√™n d√πng trong d·ª± √°n Django l√† `factory_boy`.

> `factory_boy` _gi√∫p b·∫°n x√¢y d·ª±ng d·ªØ li·ªáu model cho ki·ªÉm th·ª≠._

Khuy·∫øn ngh·ªã khi vi·∫øt ki·ªÉm th·ª≠ t·ª± ƒë·ªông l√† d√πng m·ªôt c∆° s·ªü d·ªØ li·ªáu ki·ªÉm th·ª≠ tr·ªëng. Th·ª±c t·∫ø, m·∫´u ph·ªï bi·∫øn m√† Django cung c·∫•p l√† d√πng c∆° s·ªü d·ªØ li·ªáu tr·ªëng cho m·ªói ki·ªÉm th·ª≠. C√≥ m·ªôt database tr·∫Øng gi√∫p m·ªói ki·ªÉm th·ª≠ ƒë·ªôc l·∫≠p v√† d·ªÖ ki·ªÉm tra tr·∫°ng th√°i database. V√¨ database ki·ªÉm th·ª≠ tr·ªëng, b·∫°n s·∫Ω c·∫ßn m·ªôt chi·∫øn l∆∞·ª£c ƒë·ªÉ t·∫°o d·ªØ li·ªáu ki·ªÉm th·ª≠ ph√π h·ª£p.

Khi b·∫°n ph√°t tri·ªÉn d·ª± √°n Django, b·∫°n s·∫Ω c√≥ nhi·ªÅu model m√¥ t·∫£ domain m√† website c·ªßa b·∫°n gi·∫£i quy·∫øt. Sinh d·ªØ li·ªáu model cho ki·ªÉm th·ª≠ l√† m·ªôt kh·∫£ nƒÉng c·ª±c k·ª≥ gi√° tr·ªã.

B·∫°n _c√≥ th·ªÉ_ d√πng ph∆∞∆°ng th·ª©c `create` c·ªßa model manager ƒë·ªÉ t·∫°o b·∫£n ghi database cho ki·ªÉm th·ª≠, nh∆∞ng b·∫°n s·∫Ω g·∫∑p gi·ªõi h·∫°n r·∫•t nhanh.

Th√°ch th·ª©c l·ªõn nh·∫•t khi d√πng `create` l√† c√°c r√†ng bu·ªôc database nh∆∞ foreign key. N·∫øu b·∫°n mu·ªën t·∫°o m·ªôt b·∫£n ghi c·∫ßn nhi·ªÅu foreign key kh√¥ng ƒë∆∞·ª£c null th√¨ sao? B·∫°n ch·ªâ c√≤n c√°ch t·∫°o c√°c b·∫£n ghi foreign key ƒë√≥.

Ch√∫ng ta c√≥ th·ªÉ h√¨nh dung m·ªôt ·ª©ng d·ª•ng hi·ªÉn th·ªã th√¥ng tin v·ªÅ c√°c b·ªô phim. Model `Movie` c√≥ th·ªÉ c√≥ nhi·ªÅu quan h·ªá foreign key nh∆∞ ƒë·∫°o di·ªÖn, nh√† s·∫£n xu·∫•t, h√£ng phim, v.v. T√¥i s·∫Ω s·ª≠ d·ª•ng m·ªôt v√†i quan h·ªá trong v√≠ d·ª•, nh∆∞ng h√£y t∆∞·ªüng t∆∞·ª£ng ƒëi·ªÅu g√¨ s·∫Ω x·∫£y ra khi s·ªë l∆∞·ª£ng foreign key tƒÉng l√™n.

```python
def test_detail_view_show_genre(client):
    """The genre is on the detail page."""
    director = Director.objects.create(
        name="Steven Spielberg"
    )
    producer = Producer.objects.create(
        name="George Lucas"
    )
    studio = Studio.objects.create(
        name='Paramount'
    )
    movie = Movie.objects.create(
        genre='Sci-Fi',
        director=director,
        producer=producer,
        studio=studio
    )

    response = client.get(
        reverse('movie:detail', args=[movie.id])
    )

    assert response.status_code == 200
    assert 'Sci-Fi' in response.content.decode()
```

Tho·∫°t nh√¨n, ki·ªÉm th·ª≠ n√†y kh√¥ng _qu√°_ t·ªá. T√¥i nghƒ© ph·∫ßn l·ªõn l√† do t√¥i gi·ªØ cho ph·∫ßn modeling ƒë∆°n gi·∫£n. Nh∆∞ng n·∫øu c√°c model `Director`, `Producer` ho·∫∑c `Studio` c≈©ng c√≥ c√°c kh√≥a ngo·∫°i b·∫Øt bu·ªôc th√¨ sao? Ch√∫ng ta s·∫Ω ph·∫£i d√†nh ph·∫ßn l·ªõn c√¥ng s·ª©c cho b∆∞·ªõc Arrange (s·∫Øp x·∫øp d·ªØ li·ªáu ƒë·∫ßu v√†o) c·ªßa ki·ªÉm th·ª≠. Ngo√†i ra, khi xem x√©t ki·ªÉm th·ª≠ n√†y, ch√∫ng ta b·ªã sa l·∫ßy v√†o nh·ªØng chi ti·∫øt kh√¥ng c·∫ßn thi·∫øt. Li·ªáu ch√∫ng ta c√≥ c·∫ßn bi·∫øt t√™n c·ªßa ƒë·∫°o di·ªÖn, nh√† s·∫£n xu·∫•t v√† h√£ng phim kh√¥ng? Kh√¥ng, ch√∫ng ta kh√¥ng c·∫ßn nh·ªØng th√¥ng tin ƒë√≥ cho ki·ªÉm th·ª≠ n√†y. Gi·ªù h√£y xem phi√™n b·∫£n t∆∞∆°ng ƒë∆∞∆°ng s·ª≠ d·ª•ng `factory_boy`.

```python
def test_detail_view_show_genre(client):
    """The genre is on the detail page."""
    movie = MovieFactory(genre='Sci-Fi')

    response = client.get(
        reverse('movie:detail', args=[movie.id])
    )

    assert response.status_code == 200
    assert 'Sci-Fi' in response.content.decode()
```

`MovieFactory` tr√¥ng nh∆∞ ph√©p m√†u. Ki·ªÉm th·ª≠ c·ªßa ch√∫ng ta kh√¥ng c·∫ßn quan t√¢m ƒë·∫øn c√°c chi ti·∫øt kh√°c. Gi·ªù ki·ªÉm th·ª≠ ch·ªâ t·∫≠p trung v√†o genre.

Factory ƒë∆°n gi·∫£n h√≥a vi·ªác t·∫°o b·∫£n ghi database. Thay v√¨ n·ªëi c√°c model trong ki·ªÉm th·ª≠, ta chuy·ªÉn vi·ªác ƒë√≥ sang ƒë·ªãnh nghƒ©a factory. L·ª£i √≠ch l√† ki·ªÉm th·ª≠ c√≥ th·ªÉ d√πng phong c√°ch ƒë∆°n gi·∫£n nh∆∞ v√≠ d·ª• th·ª© hai. N·∫øu c·∫ßn th√™m foreign key m·ªõi cho model, ch·ªâ c·∫ßn c·∫≠p nh·∫≠t factory, kh√¥ng ph·∫£i t·∫•t c·∫£ ki·ªÉm th·ª≠ kh√°c d√πng model ƒë√≥.

Factory `Movie` c√≥ th·ªÉ tr√¥ng nh∆∞ sau:

```python
# application/tests/factories.py

import factory

from application.models import Movie

# Other factories defined here...

class MovieFactory(factory.django.DjangoModelFactory):
    class Meta:
        model = Movie

    director = factory.SubFactory(
        DirectorFactory
    )
    producer = factory.SubFactory(
        ProducerFactory
    )
    studio = factory.SubFactory(
        StudioFactory
    )
    genre = 'Action'
```

ƒê·ªãnh nghƒ©a factory n√†y r·∫•t khai b√°o. Ta khai b√°o mu·ªën g√¨, v√† `factory_boy` s·∫Ω t·ª± bi·∫øt c√°ch gh√©p l·∫°i. ƒêi·ªÅu n√†y gi√∫p factory d·ªÖ hi·ªÉu v√¨ b·∫°n t·∫≠p trung v√†o _c√°i g√¨_ ch·ª© kh√¥ng ph·∫£i _l√†m th·∫ø n√†o_ ƒë·ªÉ t·∫°o model.

ƒêi·ªÉm ƒë√°ng ch√∫ √Ω kh√°c l√† c√°c factory c√≥ th·ªÉ k·∫øt h·ª£p v·ªõi nhau. Khi g·ªçi `MovieFactory()`, `factory_boy` thi·∫øu d·ªØ li·ªáu v·ªÅ m·ªçi th·ª© n√™n ph·∫£i t·ª± t·∫°o t·∫•t c·∫£. Th√°ch th·ª©c l√† `MovieFactory` kh√¥ng bi·∫øt t·∫°o `Director` hay c√°c foreign key kh√°c. Thay v√†o ƒë√≥, factory s·∫Ω ·ªßy quy·ªÅn cho _c√°c_ factory kh√°c qua thu·ªôc t√≠nh `SubFactory`. Nh·ªù v·∫≠y, `factory_boy` c√≥ th·ªÉ t·∫°o model v√† to√†n b·ªô c√¢y quan h·ªá ch·ªâ v·ªõi m·ªôt l·ªánh g·ªçi.

Khi mu·ªën ghi ƒë√® m·ªôt s·ªë d·ªØ li·ªáu sinh ra, b·∫°n ch·ªâ c·∫ßn truy·ªÅn th√™m tham s·ªë nh∆∞ t√¥i ƒë√£ l√†m v·ªõi ‚ÄúSci-Fi‚Äù cho tr∆∞·ªùng `genre`. B·∫°n c≈©ng c√≥ th·ªÉ truy·ªÅn instance model kh√°c v√†o factory.

`factory_boy` gi√∫p ki·ªÉm th·ª≠ v·ªõi b·∫£n ghi database tr·ªü n√™n th√∫ v·ªã. Theo kinh nghi·ªám c·ªßa t√¥i, h·∫ßu h·∫øt ki·ªÉm th·ª≠ Django ƒë·ªÅu c·∫ßn m·ªôt l∆∞·ª£ng d·ªØ li·ªáu database n√†o ƒë√≥ n√™n t√¥i d√πng factory r·∫•t nhi·ªÅu. T√¥i nghƒ© b·∫°n s·∫Ω th·∫•y `factory_boy` l√† b·ªï sung x·ª©ng ƒë√°ng cho b·ªô c√¥ng c·ª• ki·ªÉm th·ª≠ c·ªßa m√¨nh.

## T√≥m T·∫Øt

Trong b√†i vi·∫øt n√†y, ch√∫ng ta ƒë√£ t√¨m hi·ªÉu v·ªÅ ki·ªÉm th·ª≠ v·ªõi d·ª± √°n Django. Ch√∫ng ta t·∫≠p trung v√†o:

- T·∫°i sao n√™n vi·∫øt ki·ªÉm th·ª≠ t·ª± ƒë·ªông
- Nh·ªØng lo·∫°i ki·ªÉm th·ª≠ n√†o h·ªØu √≠ch cho ·ª©ng d·ª•ng Django
- Nh·ªØng c√¥ng c·ª• n√†o gi√∫p ki·ªÉm th·ª≠ d·ªÖ d√†ng h∆°n

L·∫ßn t·ªõi, ch√∫ng ta s·∫Ω t√¨m hi·ªÉu v·ªÅ tri·ªÉn khai. Tri·ªÉn khai l√† ƒë∆∞a d·ª± √°n c·ªßa b·∫°n v√†o m√¥i tr∆∞·ªùng n∆°i b·∫°n s·∫Ω chia s·∫ª ·ª©ng d·ª•ng cho ng∆∞·ªùi kh√°c s·ª≠ d·ª•ng. ƒê√≥ c√≥ th·ªÉ l√† internet ho·∫∑c m·∫°ng n·ªôi b·ªô c√¥ng ty. D√π b·∫°n tri·ªÉn khai ·ªü ƒë√¢u, b·∫°n s·∫Ω mu·ªën bi·∫øt v·ªÅ:

- Tri·ªÉn khai ·ª©ng d·ª•ng v·ªõi web application server Python (t·ª©c l√† `./manage.py runserver` kh√¥ng d√†nh cho app ƒë√£ tri·ªÉn khai)
- C√°c ƒëi·ªÅu ki·ªán ti√™n quy·∫øt khi tri·ªÉn khai ƒë·ªÉ qu·∫£n l√Ω settings, migration v√† static files
- Checklist x√°c nh·∫≠n settings ƒë√£ c·∫•u h√¨nh ƒë√∫ng c√°c b·∫£o v·ªá b·∫£o m·∫≠t
- Gi√°m s√°t ·ª©ng d·ª•ng ƒë·ªÉ ph√°t hi·ªán l·ªói
