# X√°c Th·ª±c Ng∆∞·ªùi D√πng

Trong b√†i vi·∫øt tr∆∞·ªõc c·ªßa lo·∫°t b√†i [Hi·ªÉu v·ªÅ Django](https://www.mattlayman.com/understand-django/), ch√∫ng ta ƒë√£ t√¨m hi·ªÉu v·ªÅ c·∫•u tr√∫c c·ªßa m·ªôt _·ª©ng d·ª•ng_ Django v√† c√°ch c√°c ·ª©ng d·ª•ng l√† th√†nh ph·∫ßn c·ªët l√µi c·ªßa m·ªôt d·ª± √°n Django. Trong b√†i vi·∫øt n√†y, ch√∫ng ta s·∫Ω ƒë√†o s√¢u v√†o h·ªá th·ªëng x√°c th·ª±c ng∆∞·ªùi d√πng t√≠ch h·ª£p s·∫µn c·ªßa Django. Ch√∫ng ta s·∫Ω th·∫•y Django gi√∫p b·∫°n d·ªÖ d√†ng h∆°n nh∆∞ th·∫ø n√†o b·∫±ng c√°ch cung c·∫•p c√°c c√¥ng c·ª• ƒë·ªÉ ·ª©ng d·ª•ng web c·ªßa b·∫°n t∆∞∆°ng t√°c v·ªõi ng∆∞·ªùi d√πng c·ªßa trang.

1. [T·ª´ Tr√¨nh Duy·ªát ƒê·∫øn Django](https://www.mattlayman.com/understand-django/browser-to-django/)
2. [URLs D·∫´n ƒê∆∞·ªùng](https://www.mattlayman.com/understand-django/urls-lead-way/)
3. [G√≥c Nh√¨n V·ªÅ Views](https://www.mattlayman.com/understand-django/views-on-views/)
4. [Template Cho Giao Di·ªán Ng∆∞·ªùi D√πng](https://www.mattlayman.com/understand-django/templates-user-interfaces/)
5. [T∆∞∆°ng T√°c Ng∆∞·ªùi D√πng V·ªõi Forms](https://www.mattlayman.com/understand-django/user-interaction-forms/)
6. [L∆∞u Tr·ªØ D·ªØ Li·ªáu V·ªõi Models](https://www.mattlayman.com/understand-django/store-data-with-models/)
7. [Qu·∫£n Tr·ªã M·ªçi Th·ª©](https://www.mattlayman.com/understand-django/administer-all-the-things/)
8. [Gi·∫£i Ph·∫´u M·ªôt ·ª®ng D·ª•ng](https://www.mattlayman.com/understand-django/anatomy-of-an-application/)
9. X√°c Th·ª±c Ng∆∞·ªùi D√πng
10. [Middleware B·∫°n ƒêi ƒê√¢u?](https://www.mattlayman.com/understand-django/middleware-do-you-go/)
11. [Ph·ª•c V·ª• Static Files](https://www.mattlayman.com/understand-django/serving-static-files/)
12. [Ki·ªÉm Th·ª≠ ·ª®ng D·ª•ng](https://www.mattlayman.com/understand-django/test-your-apps/)
13. [Tri·ªÉn Khai Trang Web](https://www.mattlayman.com/understand-django/deploy-site-live/)
14. [D·ªØ Li·ªáu Theo T·ª´ng Ng∆∞·ªùi D√πng V·ªõi Sessions](https://www.mattlayman.com/understand-django/sessions/)
15. [Hi·ªÉu V·ªÅ Settings](https://www.mattlayman.com/understand-django/settings/)
16. [Qu·∫£n L√Ω File Ng∆∞·ªùi D√πng](https://www.mattlayman.com/understand-django/media-files/)
17. [L·ªánh Cho ·ª®ng D·ª•ng](https://www.mattlayman.com/understand-django/command-apps/)
18. [TƒÉng T·ªëc V·ªõi Django](https://www.mattlayman.com/understand-django/go-fast/)
19. [B·∫£o M·∫≠t V√† Django](https://www.mattlayman.com/understand-django/secure-apps/)
20. [M·∫πo V√† K·ªπ Thu·∫≠t G·ª° L·ªói](https://www.mattlayman.com/understand-django/debugging-tips-techniques/)

## X√°c Th·ª±c V√† Ph√¢n Quy·ªÅn

Ch√∫ng ta c·∫ßn b·∫Øt ƒë·∫ßu v·ªõi m·ªôt s·ªë thu·∫≠t ng·ªØ tr∆∞·ªõc khi ƒëi v√†o nghi√™n c·ª©u. Khi d·ª± √°n c·ªßa b·∫°n t∆∞∆°ng t√°c v·ªõi ng∆∞·ªùi d√πng, c√≥ hai kh√≠a c·∫°nh ch√≠nh g·∫Øn li·ªÅn v·ªõi ng∆∞·ªùi d√πng m√† ch√∫ng ta ph·∫£i xem x√©t.

_X√°c th·ª±c (Authentication)_: Khi m·ªôt ng∆∞·ªùi d√πng c·ªë g·∫Øng ch·ª©ng minh h·ªç l√† ai, ƒë√≥ l√† x√°c th·ª±c. M·ªôt ng∆∞·ªùi d√πng th∆∞·ªùng x√°c th·ª±c v·ªõi trang c·ªßa b·∫°n th√¥ng qua m·ªôt form ƒëƒÉng nh·∫≠p ho·∫∑c s·ª≠ d·ª•ng nh√† cung c·∫•p x√£ h·ªôi nh∆∞ Google ƒë·ªÉ x√°c minh danh t√≠nh.

> _X√°c th·ª±c ch·ªâ c√≥ th·ªÉ ch·ª©ng minh r·∫±ng _[_b·∫°n l√† b·∫°n_](https://en.wikipedia.org/wiki/The_Important_Book)_._

_Ph√¢n quy·ªÅn (Authorization)_: Ng∆∞·ªùi d√πng ƒë∆∞·ª£c ph√©p l√†m g√¨? Ph√¢n quy·ªÅn tr·∫£ l·ªùi c√¢u h·ªèi ƒë√≥. Ch√∫ng ta d√πng ph√¢n quy·ªÅn ƒë·ªÉ x√°c ƒë·ªãnh quy·ªÅn ho·∫∑c nh√≥m m√† ng∆∞·ªùi d√πng thu·ªôc v·ªÅ, t·ª´ ƒë√≥ gi·ªõi h·∫°n nh·ªØng g√¨ ng∆∞·ªùi d√πng c√≥ th·ªÉ l√†m tr√™n trang.

> _Ph√¢n quy·ªÅn x√°c ƒë·ªãnh b·∫°n c√≥ th·ªÉ l√†m g√¨._

H·ªá th·ªëng x√°c th·ª±c c·ªßa Django bao ph·ªß c·∫£ hai ch·ªß ƒë·ªÅ n√†y. ƒê√¥i khi ng√†nh ph·∫ßn m·ªÅm s·∫Ω r√∫t g·ªçn authentication th√†nh ‚Äúauthn‚Äù v√† authorization th√†nh ‚Äúauthz‚Äù, nh∆∞ng t√¥i nghƒ© c√°c nh√£n ƒë√≥ kh√° ng·ªõ ng·∫©n v√† d·ªÖ g√¢y nh·∫ßm l·∫´n. T√¥i s·∫Ω g·ªçi r√µ t√™n ƒë·∫ßy ƒë·ªß v√† g·ªçi to√†n b·ªô h·ªá th·ªëng c·ªßa Django l√† ‚Äúauth‚Äù.

## Thi·∫øt L·∫≠p

N·∫øu b·∫°n d√πng l·ªánh `startproject` ƒë·ªÉ b·∫Øt ƒë·∫ßu d·ª± √°n, th√¨ xin ch√∫c m·ª´ng, b·∫°n ƒë√£ xong ph·∫ßn n√†y v√† c√≥ th·ªÉ chuy·ªÉn ti·∫øp!

C√°c t√≠nh nƒÉng x√°c th·ª±c trong Django y√™u c·∫ßu m·ªôt v√†i ·ª©ng d·ª•ng t√≠ch h·ª£p s·∫µn c·ªßa Django v√† m·ªôt s·ªë middleware.

C√°c ·ª©ng d·ª•ng Django l√†:

- `django.contrib.auth` v√†
- `django.contrib.contenttypes` (·ª©ng d·ª•ng `auth` ph·ª• thu·ªôc v√†o c√°i n√†y)

C√°c middleware l√†:

- `SessionMiddleware` ƒë·ªÉ l∆∞u d·ªØ li·ªáu v·ªÅ ng∆∞·ªùi d√πng trong session
- `AuthenticationMiddleware` ƒë·ªÉ li√™n k·∫øt ng∆∞·ªùi d√πng v·ªõi request

Middleware v√† session ƒë·ªÅu l√† c√°c ch·ªß ƒë·ªÅ s·∫Ω b√†n sau n√™n hi·ªán t·∫°i b·∫°n c√≥ th·ªÉ coi ch√∫ng l√† chi ti·∫øt n·ªôi b·ªô v√† b·ªè qua.

T√†i li·ªáu Django cung c·∫•p th√™m b·ªëi c·∫£nh v·ªÅ c√°c ƒëi·ªÅu ki·ªán ti√™n quy·∫øt n√†y, b·∫°n c√≥ th·ªÉ xem th√™m ·ªü ph·∫ßn [c√†i ƒë·∫∑t ch·ªß ƒë·ªÅ x√°c th·ª±c](https://docs.djangoproject.com/en/4.1/topics/auth/#installation).

## Ai S·∫Ω X√°c Th·ª±c?

N·∫øu trang c·ªßa b·∫°n s·∫Ω c√≥ b·∫•t k·ª≥ m·ª©c ƒë·ªô c√° nh√¢n h√≥a n√†o cho ng∆∞·ªùi d√πng, th√¨ ch√∫ng ta c·∫ßn m·ªôt c√°ch ƒë·ªÉ theo d√µi danh t√≠nh.

Trong h·ªá th·ªëng x√°c th·ª±c c·ªßa Django, danh t√≠nh ƒë∆∞·ª£c theo d√µi b·∫±ng model `User`. Model n√†y l∆∞u tr·ªØ th√¥ng tin m√† b·∫°n c√≥ th·ªÉ mu·ªën li√™n k·∫øt v·ªõi b·∫•t k·ª≥ ai s·ª≠ d·ª•ng trang c·ªßa b·∫°n. Model bao g·ªìm:

- c√°c tr∆∞·ªùng t√™n,
- ƒë·ªãa ch·ªâ email,
- c√°c tr∆∞·ªùng ng√†y gi·ªù cho th·ªùi ƒëi·ªÉm ng∆∞·ªùi d√πng tham gia ho·∫∑c ƒëƒÉng nh·∫≠p v√†o trang,
- c√°c tr∆∞·ªùng boolean cho m·ªôt s·ªë quy·ªÅn c∆° b·∫£n r·∫•t th∆∞·ªùng d√πng,
- v√† d·ªØ li·ªáu m·∫≠t kh·∫©u.

Model `User` l√† m·ªôt model c·ª±c k·ª≥ quan tr·ªçng trong nhi·ªÅu h·ªá th·ªëng. Tr·ª´ khi b·∫°n t·∫°o m·ªôt website ho√†n to√†n c√¥ng khai v√† kh√¥ng c·∫ßn quan t√¢m ƒë·∫øn danh t√≠nh, b·∫°n c√≥ l·∫Ω s·∫Ω s·ª≠ d·ª•ng model `User` r·∫•t nhi·ªÅu.

Ngay c·∫£ khi b·∫°n _kh√¥ng_ mong ƒë·ª£i kh√°ch truy c·∫≠p trang c·ªßa m√¨nh ph·∫£i x√°c ƒë·ªãnh danh t√≠nh, b·∫°n v·∫´n c√≥ th·ªÉ h∆∞·ªüng l·ª£i t·ª´ model `User` v√¨ n√≥ ƒë∆∞·ª£c t√≠ch h·ª£p v·ªõi trang qu·∫£n tr·ªã Django. T√¥i ƒë√£ ƒë·ªÅ c·∫≠p trong [Qu·∫£n Tr·ªã M·ªçi Th·ª©](https://www.mattlayman.com/understand-django/administer-all-the-things/) r·∫±ng ch√∫ng ta c·∫ßn m·ªôt ng∆∞·ªùi d√πng c√≥ quy·ªÅn nh·∫•t ƒë·ªãnh ƒë·ªÉ truy c·∫≠p admin, nh∆∞ng t√¥i ƒë√£ l∆∞·ªõt qua chi ti·∫øt ƒëi·ªÅu ƒë√≥ nghƒ©a l√† g√¨.

Trang admin ch·ªâ cho ph√©p ng∆∞·ªùi d√πng c√≥ thu·ªôc t√≠nh `is_staff` ƒë∆∞·ª£c ƒë·∫∑t l√† `True`. `is_staff` l√† m·ªôt trong c√°c tr∆∞·ªùng boolean m√† t√¥i ƒë√£ li·ªát k√™ l√† c√≥ trong model `User` m·∫∑c ƒë·ªãnh.

Gi·ªù ch√∫ng ta ƒë√£ hi·ªÉu r·∫±ng model `User` l√† m·ªôt model r·∫•t quan tr·ªçng trong m·ªôt trang Django. T·ªëi thi·ªÉu, model n√†y quan tr·ªçng khi b·∫°n d√πng trang admin Django, nh∆∞ng n√≥ c≈©ng c√≥ th·ªÉ r·∫•t quan tr·ªçng v·ªõi nh·ªØng ng∆∞·ªùi truy c·∫≠p trang c·ªßa b·∫°n.

Ti·∫øp theo, h√£y xem s√¢u h∆°n v·ªÅ x√°c th·ª±c v√† c√°ch n√≥ ho·∫°t ƒë·ªông c√πng v·ªõi model `User`.

## X√°c Th·ª±c B·∫±ng M·∫≠t Kh·∫©u

Gi·ªëng nh∆∞ nhi·ªÅu website kh√°c m√† b·∫°n t·ª´ng d√πng, h·ªá th·ªëng x√°c th·ª±c t√≠ch h·ª£p c·ªßa Django x√°c th·ª±c ng∆∞·ªùi d√πng b·∫±ng m·∫≠t kh·∫©u.

Khi m·ªôt ng∆∞·ªùi d√πng mu·ªën x√°c th·ª±c, h·ªç ph·∫£i ƒëƒÉng nh·∫≠p v√†o trang. Django cung c·∫•p m·ªôt view d·∫°ng class `LoginView` c√≥ th·ªÉ x·ª≠ l√Ω c√°c b∆∞·ªõc c·∫ßn thi·∫øt. `LoginView` l√† m·ªôt form view m√†:

- Thu th·∫≠p `username` v√† `password` t·ª´ ng∆∞·ªùi d√πng
- G·ªçi h√†m `django.contrib.auth.authenticate` v·ªõi `username` v√† `password` ƒë·ªÉ x√°c nh·∫≠n ng∆∞·ªùi d√πng l√† ai h·ªç n√≥i
- Chuy·ªÉn h∆∞·ªõng ƒë·∫øn m·ªôt ƒë∆∞·ªùng d·∫´n ƒë∆∞·ª£c ƒë·∫∑t trong tham s·ªë `next` c·ªßa querystring URL ho·∫∑c `settings.LOGIN_REDIRECT_URL` n·∫øu kh√¥ng c√≥ tham s·ªë `next`
- Ho·∫∑c, n·∫øu x√°c th·ª±c th·∫•t b·∫°i, render l·∫°i trang form v·ªõi th√¥ng b√°o l·ªói ph√π h·ª£p

H√†m `authenticate` ho·∫°t ƒë·ªông nh∆∞ th·∫ø n√†o? H√†m `authenticate` ·ªßy quy·ªÅn tr√°ch nhi·ªám quy·∫øt ƒë·ªãnh th√¥ng tin x√°c th·ª±c c·ªßa ng∆∞·ªùi d√πng c√≥ h·ª£p l·ªá kh√¥ng cho m·ªôt _authentication backend_.

Nh∆∞ ch√∫ng ta ƒë√£ th·∫•y v·ªõi template v√† c∆° s·ªü d·ªØ li·ªáu, h·ªá th·ªëng x√°c th·ª±c c≈©ng c√≥ c√°c backend c√≥ th·ªÉ ho√°n ƒë·ªïi. V·ªõi c√°c backend kh√°c nhau, b·∫°n c√≥ th·ªÉ c√≥ nhi·ªÅu c√°ch x√°c th·ª±c. H√†m `authenticate` s·∫Ω l·∫∑p qua c√°c backend x√°c th·ª±c ƒë∆∞·ª£c thi·∫øt l·∫≠p trong danh s√°ch `AUTHENTICATION_BACKENDS` trong settings. M·ªói backend c√≥ th·ªÉ l√†m m·ªôt trong ba vi·ªác:

- X√°c th·ª±c ƒë√∫ng v·ªõi ng∆∞·ªùi d√πng v√† tr·∫£ v·ªÅ m·ªôt instance `User`.
- Kh√¥ng x√°c th·ª±c v√† tr·∫£ v·ªÅ `None`. Khi ƒë√≥ backend ti·∫øp theo s·∫Ω ƒë∆∞·ª£c th·ª≠.
- Kh√¥ng x√°c th·ª±c v√† raise exception `PermissionDenied`. Khi ƒë√≥ s·∫Ω kh√¥ng th·ª≠ backend n√†o n·ªØa.

B·∫°n c√≥ th·ªÉ th√™m m·ªôt backend v√†o thi·∫øt l·∫≠p ƒë√≥ ƒë·ªÉ cho ph√©p ng∆∞·ªùi d√πng x√°c th·ª±c b·∫±ng t√†i kho·∫£n m·∫°ng x√£ h·ªôi (v√≠ d·ª• [django-allauth](https://django-allauth.readthedocs.io/en/latest/) l√† m·ªôt l·ª±a ch·ªçn tuy·ªát v·ªùi). B·∫°n c√≥ th·ªÉ ·ªü m√¥i tr∆∞·ªùng doanh nghi·ªáp v√† c·∫ßn Single Sign-On (SSO) cho c√¥ng ty. C≈©ng c√≥ c√°c backend h·ªó tr·ª£ ƒëi·ªÅu ƒë√≥.

D√π c√≥ nhi·ªÅu l·ª±a ch·ªçn, ch√∫ng ta s·∫Ω t·∫≠p trung v√†o backend t√≠ch h·ª£p s·∫µn ƒëi k√®m h·ªá th·ªëng x√°c th·ª±c. Backend m·∫∑c ƒë·ªãnh g·ªçi l√† `ModelBackend` v√† n·∫±m trong module `django.contrib.auth.backends`.

`ModelBackend` ƒë∆∞·ª£c ƒë·∫∑t t√™n nh∆∞ v·∫≠y v√¨ n√≥ d√πng model `User` ƒë·ªÉ x√°c th·ª±c. Khi nh·∫≠n ƒë∆∞·ª£c `username` v√† `password` t·ª´ ng∆∞·ªùi d√πng, backend s·∫Ω so s√°nh d·ªØ li·ªáu ƒë√≥ v·ªõi c√°c b·∫£n ghi `User` hi·ªán c√≥.

H√†m `authenticate` s·∫Ω g·ªçi _ph∆∞∆°ng th·ª©c_ `authenticate` tr√™n `ModelBackend`. Backend s·∫Ω t√¨m m·ªôt b·∫£n ghi `User` d·ª±a tr√™n `username` ƒë∆∞·ª£c truy·ªÅn v√†o ph∆∞∆°ng th·ª©c b·ªüi h√†m `authenticate`. N·∫øu b·∫£n ghi ng∆∞·ªùi d√πng t·ªìn t·∫°i, backend s·∫Ω g·ªçi `user.check_password(password)` v·ªõi `password` l√† m·∫≠t kh·∫©u th·ª±c t·∫ø do ng∆∞·ªùi d√πng g·ª≠i l√™n qua POST t·ªõi `LoginView`.

Django kh√¥ng l∆∞u m·∫≠t kh·∫©u th·ª±c t·∫ø. L√†m v·∫≠y s·∫Ω l√† m·ªôt ƒëi·ªÉm y·∫øu l·ªõn v√¨ n·∫øu c∆° s·ªü d·ªØ li·ªáu b·ªã l·ªô th√¨ to√†n b·ªô m·∫≠t kh·∫©u ng∆∞·ªùi d√πng c≈©ng b·ªã l·ªô. Thay v√†o ƒë√≥, tr∆∞·ªùng `password` tr√™n model `User` l∆∞u _hash_ c·ªßa m·∫≠t kh·∫©u.

C√≥ th·ªÉ b·∫°n ch∆∞a t·ª´ng g·∫∑p hashing tr∆∞·ªõc ƒë√¢y. Hash l√† m·ªôt gi√° tr·ªã ƒë∆∞·ª£c t√≠nh to√°n b·∫±ng c√°ch ƒë∆∞a d·ªØ li·ªáu ƒë·∫ßu v√†o qua m·ªôt h√†m ƒë·∫∑c bi·ªát. Chi ti·∫øt v·ªÅ t√≠nh to√°n hash l√† m·ªôt ch·ªß ƒë·ªÅ r·∫•t s√¢u, nh·∫•t l√† khi x√©t v·ªÅ b·∫£o m·∫≠t, nh∆∞ng ƒëi·ªÅu quan tr·ªçng c·∫ßn bi·∫øt l√† b·∫°n _kh√¥ng th·ªÉ ƒë·∫£o ng∆∞·ª£c_ ph√©p t√≠nh n√†y.

N√≥i c√°ch kh√°c, n·∫øu b·∫°n t·∫°o hash t·ª´ `mysekretpassword`, b·∫°n s·∫Ω kh√¥ng th·ªÉ l·∫•y gi√° tr·ªã hash ƒë√≥ ƒë·ªÉ t√¨m ra ƒë·∫ßu v√†o g·ªëc l√† `myseckretpassword`.

T·∫°i sao ƒëi·ªÅu n√†y h·ªØu √≠ch? B·∫±ng c√°ch t√≠nh to√°n hash, Django c√≥ th·ªÉ l∆∞u gi√° tr·ªã ƒë√£ t√≠nh to√°n ƒë√≥ m√† kh√¥ng l√†m l·ªô m·∫≠t kh·∫©u ng∆∞·ªùi d√πng. Khi ng∆∞·ªùi d√πng mu·ªën x√°c th·ª±c v·ªõi trang, h·ªç g·ª≠i m·∫≠t kh·∫©u, Django s·∫Ω t√≠nh hash tr√™n gi√° tr·ªã g·ª≠i l√™n v√† _so s√°nh v·ªõi hash l∆∞u trong c∆° s·ªü d·ªØ li·ªáu._ N·∫øu hai hash tr√πng nhau, trang c√≥ th·ªÉ k·∫øt lu·∫≠n ng∆∞·ªùi d√πng ƒë√£ g·ª≠i ƒë√∫ng m·∫≠t kh·∫©u. Ch·ªâ hash c·ªßa m·∫≠t kh·∫©u ƒë√∫ng m·ªõi tr√πng v·ªõi hash l∆∞u trong model `User`.

Hashing l√† m·ªôt ch·ªß ƒë·ªÅ th√∫ v·ªã. N·∫øu b·∫°n mu·ªën t√¨m hi·ªÉu th√™m v·ªÅ c√°ch Django qu·∫£n l√Ω hash, h√£y ƒë·ªçc [Qu·∫£n l√Ω m·∫≠t kh·∫©u trong Django](https://docs.djangoproject.com/en/4.1/topics/auth/passwords/) ƒë·ªÉ xem chi ti·∫øt.

## C√°c View X√°c Th·ª±c

C√≥ r·∫•t nhi·ªÅu th·ª© ph·∫£i l√†m cho x√°c th·ª±c!

Django c√≥ b·∫Øt b·∫°n ph·∫£i t·ª± g·ªçi h√†m `authenticate` v√† t·ª± k·∫øt n·ªëi c√°c view kh√¥ng? Kh√¥ng!

T√¥i ƒë√£ ƒë·ªÅ c·∫≠p ƒë·∫øn `LoginView` ·ªü tr√™n, nh∆∞ng ƒë√≥ kh√¥ng ph·∫£i l√† view duy nh·∫•t m√† Django cung c·∫•p ƒë·ªÉ gi√∫p qu·∫£n l√Ω x√°c th·ª±c. B·∫°n c√≥ th·ªÉ th√™m b·ªô view n√†y ch·ªâ v·ªõi m·ªôt d√≤ng `include`:

```python
# project/urls.py

from django.urls import include, path

urlpatterns = [
    ...
    path(
        "accounts/",
        include("django.contrib.auth.urls")
    ),
]
```

B·ªô n√†y bao g·ªìm nhi·ªÅu t√≠nh nƒÉng:

- View ƒëƒÉng nh·∫≠p
- View ƒëƒÉng xu·∫•t
- View ƒë·ªïi m·∫≠t kh·∫©u
- View ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u

N·∫øu b·∫°n ch·ªçn th√™m b·ªô n√†y, vi·ªác c·ªßa b·∫°n l√† override c√°c template t√≠ch h·ª£p s·∫µn ƒë·ªÉ ph√π h·ª£p v·ªõi giao di·ªán trang c·ªßa b·∫°n. V√≠ d·ª•, ƒë·ªÉ t√πy bi·∫øn view ƒëƒÉng xu·∫•t, b·∫°n s·∫Ω t·∫°o m·ªôt file t√™n l√† `registration/logged_out.html` trong th∆∞ m·ª•c template c·ªßa b·∫°n. [T√†i li·ªáu v·ªÅ t·∫•t c·∫£ c√°c view x√°c th·ª±c](https://docs.djangoproject.com/en/4.1/topics/auth/default/#all-authentication-views) cung c·∫•p th√¥ng tin v·ªÅ t·ª´ng view v√† t√™n template c·∫ßn override. L∆∞u √Ω b·∫°n _ph·∫£i_ cung c·∫•p template cho view ƒëƒÉng nh·∫≠p v√¨ framework kh√¥ng cung c·∫•p template m·∫∑c ƒë·ªãnh cho view ƒë√≥.

N·∫øu b·∫°n c√≥ nhu c·∫ßu ph·ª©c t·∫°p h∆°n cho trang c·ªßa m√¨nh, b·∫°n c√≥ th·ªÉ c√¢n nh·∫Øc c√°c ·ª©ng d·ª•ng Django b√™n ngo√†i trong h·ªá sinh th√°i. C√° nh√¢n t√¥i th√≠ch [django-allauth](https://django-allauth.readthedocs.io/en/latest/). D·ª± √°n n√†y r·∫•t d·ªÖ t√πy bi·∫øn v√† cung c·∫•p c√°ch th√™m x√°c th·ª±c x√£ h·ªôi ƒë·ªÉ ƒëƒÉng k√Ω b·∫±ng n·ªÅn t·∫£ng m·∫°ng x√£ h·ªôi b·∫°n ch·ªçn. T√¥i c≈©ng th√≠ch django-allauth v√¨ n√≥ c√≥ s·∫µn lu·ªìng ƒëƒÉng k√Ω m√† b·∫°n kh√¥ng ph·∫£i t·ª± x√¢y d·ª±ng. ·ª®ng d·ª•ng n√†y r·∫•t ƒë√°ng ƒë·ªÉ th·ª≠.

Ch√∫ng ta ƒë√£ th·∫•y Django x√°c th·ª±c ng∆∞·ªùi d√πng v·ªõi model `User`, h√†m `authenticate` v√† backend x√°c th·ª±c t√≠ch h·ª£p `ModelBackend`. Ch√∫ng ta c≈©ng ƒë√£ th·∫•y Django cung c·∫•p c√°c view h·ªó tr·ª£ ƒëƒÉng nh·∫≠p, ƒëƒÉng xu·∫•t v√† qu·∫£n l√Ω m·∫≠t kh·∫©u.

Khi m·ªôt ng∆∞·ªùi d√πng ƒë√£ x√°c th·ª±c, h·ªç ƒë∆∞·ª£c ph√©p l√†m g√¨? Ch√∫ng ta s·∫Ω xem ti·∫øp khi t√¨m hi·ªÉu v·ªÅ ph√¢n quy·ªÅn trong Django.

## ƒê∆∞·ª£c Ph√©p L√†m G√¨?

### Ph√¢n Quy·ªÅn D·ª±a Tr√™n Thu·ªôc T√≠nh Ng∆∞·ªùi D√πng

Django c√≥ nhi·ªÅu c√°ch ƒë·ªÉ b·∫°n ki·ªÉm so√°t ng∆∞·ªùi d√πng ƒë∆∞·ª£c ph√©p l√†m g√¨ tr√™n trang.

C√°ch ƒë∆°n gi·∫£n nh·∫•t ƒë·ªÉ ki·ªÉm tra ng∆∞·ªùi d√πng l√† xem trang ƒë√£ nh·∫≠n di·ªán ng∆∞·ªùi d√πng hay ch∆∞a. Tr∆∞·ªõc khi ng∆∞·ªùi d√πng x√°c th·ª±c b·∫±ng c√°ch ƒëƒÉng nh·∫≠p, h·ªç l√† ng∆∞·ªùi d√πng ·∫©n danh. Th·ª±c t·∫ø, h·ªá th·ªëng x√°c th·ª±c Django c√≥ m·ªôt class ƒë·∫∑c bi·ªát ƒë·ªÉ bi·ªÉu di·ªÖn lo·∫°i ng∆∞·ªùi d√πng n√†y. ƒê√∫ng nh∆∞ nguy√™n t·∫Øc ‚Äú√≠t g√¢y b·∫•t ng·ªù‚Äù, class n√†y t√™n l√† `AnonymousUser`.

Model `User` c√≥ thu·ªôc t√≠nh `is_authenticated`. D·ªÖ ƒëo√°n, ng∆∞·ªùi d√πng ƒë√£ x√°c th·ª±c s·∫Ω tr·∫£ v·ªÅ `True` cho `is_authenticated` c√≤n instance `AnonymousUser` s·∫Ω tr·∫£ v·ªÅ `False` cho thu·ªôc t√≠nh n√†y.

Django cung c·∫•p decorator `login_required` c√≥ th·ªÉ d√πng th√¥ng tin `is_authenticated` n√†y. Decorator n√†y s·∫Ω ch·∫∑n b·∫•t k·ª≥ view n√†o c·∫ßn ng∆∞·ªùi d√πng ƒë√£ x√°c th·ª±c.

ƒê√¢y c√≥ th·ªÉ l√† m·ª©c ki·ªÉm tra ph√¢n quy·ªÅn ph√π h·ª£p n·∫øu b·∫°n c√≥ ·ª©ng d·ª•ng ch·ªâ cho ph√©p m·ªôt s·ªë ng∆∞·ªùi ƒëƒÉng nh·∫≠p. V√≠ d·ª•, n·∫øu b·∫°n v·∫≠n h√†nh m·ªôt ·ª©ng d·ª•ng SaaS y√™u c·∫ßu ng∆∞·ªùi d√πng tr·∫£ ph√≠ ƒë·ªÉ s·ª≠ d·ª•ng s·∫£n ph·∫©m, b·∫°n c√≥ th·ªÉ ch·ªâ c·∫ßn ki·ªÉm tra `is_authenticated` l√† ƒë·ªß. Trong tr∆∞·ªùng h·ª£p ƒë√≥, n·∫øu ·ª©ng d·ª•ng ch·ªâ cho ph√©p ng∆∞·ªùi d√πng c√≥ ƒëƒÉng k√Ω (ho·∫∑c d√πng th·ª≠) ƒëƒÉng nh·∫≠p, `login_required` s·∫Ω ngƒÉn kh√¥ng cho ng∆∞·ªùi d√πng kh√¥ng tr·∫£ ph√≠ s·ª≠ d·ª•ng s·∫£n ph·∫©m.

C√≥ c√°c gi√° tr·ªã boolean kh√°c tr√™n model `User` m√† b·∫°n c√≥ th·ªÉ d√πng ƒë·ªÉ ki·ªÉm tra ph√¢n quy·ªÅn.

- `is_staff` l√† boolean ƒë·ªÉ quy·∫øt ƒë·ªãnh ng∆∞·ªùi d√πng c√≥ ph·∫£i l√† nh√¢n vi√™n kh√¥ng. M·∫∑c ƒë·ªãnh, gi√° tr·ªã n√†y l√† `False`. Ch·ªâ ng∆∞·ªùi d√πng staff m·ªõi ƒë∆∞·ª£c d√πng trang admin t√≠ch h·ª£p c·ªßa Django. B·∫°n c≈©ng c√≥ th·ªÉ d√πng decorator `staff_member_required` n·∫øu c√≥ c√°c view ch·ªâ d√†nh cho th√†nh vi√™n nh√≥m c·ªßa b·∫°n c√≥ quy·ªÅn ƒë√≥.
- `is_superuser` l√† c·ªù ƒë·∫∑c bi·ªát ƒë·ªÉ ch·ªâ ng∆∞·ªùi d√πng c√≥ quy·ªÅn truy c·∫≠p m·ªçi th·ª©. Kh√°i ni·ªám ‚Äúsuperuser‚Äù n√†y r·∫•t gi·ªëng v·ªõi superuser trong h·ªá th·ªëng ph√¢n quy·ªÅn c·ªßa Linux. Kh√¥ng c√≥ decorator ƒë·∫∑c bi·ªát cho boolean n√†y, nh∆∞ng b·∫°n c√≥ th·ªÉ d√πng decorator `user_passes_test` n·∫øu c√≥ c√°c view ri√™ng t∆∞ c·∫ßn b·∫£o v·ªá.

```python
from django.contrib.admin.views.decorators import (
    staff_member_required
)
from django.contrib.auth.decorators import (
    user_passes_test
)
from django.http import HttpResponse

@staff_member_required
def a_staff_view(request):
    return HttpResponse(
        "You are a user with staff level permission."
    )

def check_superuser(user):
    return user.is_superuser

@user_passes_test(check_superuser)
def special_view(request):
    return HttpResponse(
        "Super special response"
    )
```

Decorator `user_passes_test` ho·∫°t ƒë·ªông gi·ªëng nh∆∞ `login_required`, nh∆∞ng n√≥ nh·∫≠n m·ªôt callable nh·∫≠n v√†o m·ªôt object user v√† tr·∫£ v·ªÅ boolean. N·∫øu gi√° tr·ªã boolean l√† `True`, request ƒë∆∞·ª£c ph√©p v√† ng∆∞·ªùi d√πng nh·∫≠n response. N·∫øu boolean l√† `False`, ng∆∞·ªùi d√πng s·∫Ω b·ªã chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang ƒëƒÉng nh·∫≠p.

### Ph√¢n Quy·ªÅn D·ª±a Tr√™n Quy·ªÅn V√† Nh√≥m

B·ªô ki·ªÉm tra ƒë·∫ßu ti√™n m√† ch√∫ng ta xem l√† d·ªØ li·ªáu l∆∞u c√πng b·∫£n ghi model `User`. D√π c√°ch n√†y ph√π h·ª£p v·ªõi m·ªôt s·ªë tr∆∞·ªùng h·ª£p, c√≤n ph√¢n quy·ªÅn ph·ª• thu·ªôc v√†o ch·ª©c nƒÉng ·ª©ng d·ª•ng th√¨ sao?

Django ƒëi k√®m h·ªá th·ªëng quy·ªÅn linh ho·∫°t cho ph√©p ·ª©ng d·ª•ng ki·ªÉm so√°t ai ƒë∆∞·ª£c xem g√¨. H·ªá th·ªëng quy·ªÅn bao g·ªìm m·ªôt s·ªë quy·ªÅn t·ª± ƒë·ªông t·∫°o c≈©ng nh∆∞ kh·∫£ nƒÉng t·∫°o quy·ªÅn t√πy bi·∫øn cho b·∫•t k·ª≥ m·ª•c ƒë√≠ch n√†o. C√°c b·∫£n ghi quy·ªÅn n√†y l√† instance model `Permission` t·ª´ `django.contrib.auth.models`.

B·∫•t c·ª© khi n√†o b·∫°n t·∫°o m·ªôt model m·ªõi, Django s·∫Ω t·∫°o th√™m m·ªôt b·ªô quy·ªÅn. C√°c quy·ªÅn t·ª± ƒë·ªông n√†y √°nh x·∫° t·ªõi c√°c thao t√°c CRUD m√† b·∫°n c√≥ th·ªÉ d√πng trong admin Django. V√≠ d·ª•, n·∫øu b·∫°n c√≥ app `pizzas` v√† t·∫°o model `Topping`, Django s·∫Ω t·∫°o c√°c quy·ªÅn sau:

- `pizzas.add_topping` cho Create
- `pizzas.view_topping` cho Read
- `pizzas.change_topping` cho Update
- `pizzas.delete_topping` cho Delete

L√Ω do l·ªõn ƒë·ªÉ t·∫°o c√°c quy·ªÅn n√†y l√† ƒë·ªÉ h·ªó tr·ª£ ph√°t tri·ªÉn _v√†_ ki·ªÉm so√°t trong admin Django. Ng∆∞·ªùi d√πng staff (t·ª©c l√† `user.is_staff == True`) trong ·ª©ng d·ª•ng c·ªßa b·∫°n ban ƒë·∫ßu _kh√¥ng c√≥ quy·ªÅn n√†o_. ƒê√¢y l√† m·∫∑c ƒë·ªãnh an to√†n ƒë·ªÉ b·∫•t k·ª≥ nh√¢n vi√™n m·ªõi n√†o c≈©ng kh√¥ng th·ªÉ truy c·∫≠p to√†n b·ªô d·ªØ li·ªáu h·ªá th·ªëng tr·ª´ khi b·∫°n c·∫•p th√™m quy·ªÅn khi ƒë√£ tin t∆∞·ªüng h·ªç.

Khi m·ªôt ng∆∞·ªùi d√πng staff ƒëƒÉng nh·∫≠p v√†o admin Django, ban ƒë·∫ßu h·ªç s·∫Ω th·∫•y r·∫•t √≠t. Khi c·∫•p th√™m quy·ªÅn cho t√†i kho·∫£n, admin Django s·∫Ω hi·ªÉn th·ªã th√™m th√¥ng tin t∆∞∆°ng ·ª©ng v·ªõi quy·ªÅn ƒë√£ ch·ªçn. D√π quy·ªÅn th∆∞·ªùng ƒë∆∞·ª£c c·∫•p qua trang admin c·ªßa `User`, b·∫°n c≈©ng c√≥ th·ªÉ th√™m quy·ªÅn cho user qua m√£. Model `User` c√≥ m·ªôt tr∆∞·ªùng `ManyToManyField` t√™n l√† `user_permissions` li√™n k·∫øt instance user v·ªõi c√°c quy·ªÅn c·ª• th·ªÉ.

Ti·∫øp t·ª•c v·ªõi v√≠ d·ª• ·ª©ng d·ª•ng pizza, gi·∫£ s·ª≠ b·∫°n l√†m vi·ªác v·ªõi m·ªôt ƒë·∫ßu b·∫øp cho app pizza. ƒê·∫ßu b·∫øp c·ªßa b·∫°n c√≥ th·ªÉ c·∫ßn quy·ªÅn ki·ªÉm so√°t c√°c topping m·ªõi cho kh√°ch h√†ng, nh∆∞ng b·∫°n c√≥ l·∫Ω kh√¥ng mu·ªën ƒë·∫ßu b·∫øp x√≥a ƒë∆°n h√†ng kh·ªèi l·ªãch s·ª≠ ·ª©ng d·ª•ng.

V·ªõi ƒë·∫ßu b·∫øp, b·∫°n s·∫Ω c·∫•p quy·ªÅn `pizzas.add_topping`, `pizzas.view_topping`, v√† `pizzas.change_topping`, nh∆∞ng kh√¥ng c·∫•p `orders.delete_order`.

```python
from django.contrib.auth.models import (
    Permission, User
)
from django.contrib.contenttypes.models import (
    ContentType
)
from pizzas.models import Topping

content_type = ContentType.objects.get_for_model(
    Topping
)
permission = Permission.objects.get(
    content_type=content_type,
    codename="add_topping"
)
chef_id = 42
chef = User.objects.get(id=42)
chef.user_permissions.add(permission)
```

Ch√∫ng ta ch∆∞a b√†n v·ªÅ app `contenttypes` n√™n ƒëo·∫°n m√£ n√†y c√≥ th·ªÉ l·∫° v·ªõi b·∫°n, nh∆∞ng h·ªá th·ªëng x√°c th·ª±c d√πng content type ƒë·ªÉ tham chi·∫øu model m·ªôt c√°ch t·ªïng qu√°t khi x·ª≠ l√Ω quy·ªÅn. B·∫°n c√≥ th·ªÉ t√¨m hi·ªÉu th√™m v·ªÅ content type v√† c√°ch d√πng t·∫°i [t√†i li·ªáu contenttypes framework](https://docs.djangoproject.com/en/4.1/ref/contrib/contenttypes/). ƒêi·ªÅu quan tr·ªçng l√† quy·ªÅn ho·∫°t ƒë·ªông nh∆∞ b·∫•t k·ª≥ model Django n√†o kh√°c.

Th√™m quy·ªÅn cho t·ª´ng user l√† t√≠nh nƒÉng hay cho nh√≥m nh·ªè, nh∆∞ng n·∫øu nh√≥m c·ªßa b·∫°n l·ªõn, vi·ªác n√†y c√≥ th·ªÉ tr·ªü th√†nh √°c m·ªông.

Gi·∫£ s·ª≠ ·ª©ng d·ª•ng c·ªßa b·∫°n r·∫•t th√†nh c√¥ng v√† b·∫°n c·∫ßn thu√™ m·ªôt ƒë·ªôi ng≈© h·ªó tr·ª£ l·ªõn ƒë·ªÉ gi√∫p kh√°ch h√†ng. N·∫øu ƒë·ªôi h·ªó tr·ª£ c·∫ßn xem m·ªôt s·ªë model trong h·ªá th·ªëng, s·∫Ω r·∫•t phi·ªÅn n·∫øu b·∫°n ph·∫£i qu·∫£n l√Ω quy·ªÅn cho t·ª´ng th√†nh vi√™n.

Django c√≥ kh·∫£ nƒÉng t·∫°o nh√≥m ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ n√†y. Model `Group` l√† giao ƒëi·ªÉm gi·ªØa m·ªôt t·∫≠p quy·ªÅn v√† m·ªôt t·∫≠p ng∆∞·ªùi d√πng. Nh∆∞ v·∫≠y, b·∫°n c√≥ th·ªÉ t·∫°o m·ªôt nh√≥m nh∆∞ ‚ÄúSupport Team‚Äù, g√°n t·∫•t c·∫£ quy·ªÅn m√† nh√≥m c·∫ßn, v√† th√™m t·∫•t c·∫£ nh√¢n vi√™n h·ªó tr·ª£ v√†o nh√≥m ƒë√≥. Khi c·∫ßn c·∫•p quy·ªÅn m·ªõi cho nh√≥m, ch·ªâ c·∫ßn th√™m m·ªôt l·∫ßn v√†o nh√≥m.

C√°c nh√≥m c·ªßa user ƒë∆∞·ª£c theo d√µi b·∫±ng m·ªôt tr∆∞·ªùng `ManyToManyField` kh√°c t√™n l√† `groups`.

```python
from django.contrib.auth.models import (
    Group, User
)

support_team = Group.objects.get(
    name="Support Team"
)
support_sally = User.objects.get(
    username="sally"
)
support_sally.groups.add(support_team)
```

Ngo√†i c√°c quy·ªÅn t√≠ch h·ª£p m√† Django t·∫°o v√† h·ªá th·ªëng qu·∫£n l√Ω nh√≥m, b·∫°n c≈©ng c√≥ th·ªÉ t·∫°o th√™m quy·ªÅn cho m·ª•c ƒë√≠ch ri√™ng.

H√£y c·∫•p cho ƒë·∫ßu b·∫øp quy·ªÅn n∆∞·ªõng pizza trong app t∆∞·ªüng t∆∞·ª£ng c·ªßa ch√∫ng ta.

```python
from django.contrib.auth.models import (
    Permission, User
)
from django.contrib.contenttypes.models import (
    ContentType
)
from pizzas.models import Pizza

content_type = ContentType.objects.get_for_model(
    Pizza
)
permission = Permission.objects.create(
    codename="can_bake",
    name="Can Bake Pizza",
    content_type=content_type,
)
chef_id = 42
chef = User.objects.get(id=42)
chef.user_permissions.add(permission)
```

ƒê·ªÉ ki·ªÉm tra quy·ªÅn trong m√£, b·∫°n c√≥ th·ªÉ d√πng ph∆∞∆°ng th·ª©c `has_perm` tr√™n model `User`. `has_perm` nh·∫≠n m·ªôt app label v√† codename quy·ªÅn n·ªëi v·ªõi nhau b·∫±ng d·∫•u ch·∫•m.

```python
>>> chef = User.objects.get(id=42)
>>> chef.has_perm('pizzas.can_bake')
True
```

B·∫°n c≈©ng c√≥ th·ªÉ d√πng decorator tr√™n view ƒë·ªÉ ki·ªÉm tra quy·ªÅn. Decorator s·∫Ω ki·ªÉm tra `request.user` c√≥ quy·ªÅn ph√π h·ª£p kh√¥ng.

```python
# pizzas/views.py

from django.contrib.auth.decorators import permission_required

@permission_required('pizzas.can_bake')
def bake_pizza(request):
    # Time to bake the pizza
    # if you're allowed.
    ...
```

## L√†m Vi·ªác V·ªõi Ng∆∞·ªùi D√πng Trong View V√† Template

Ch√∫ng ta ƒë√£ b√†n v·ªÅ c√°ch x√°c th·ª±c ng∆∞·ªùi d√πng v√† ki·ªÉm tra ph√¢n quy·ªÅn. V·∫≠y l√†m sao _t∆∞∆°ng t√°c_ v·ªõi ng∆∞·ªùi d√πng trong m√£ ·ª©ng d·ª•ng?

C√°ch ƒë·∫ßu ti√™n l√† trong view. M·ªôt ph·∫ßn c·ªßa vi·ªác c·∫•u h√¨nh h·ªá th·ªëng x√°c th·ª±c l√† th√™m `AuthenticationMiddleware` trong `django.contrib.auth.middleware`.

Middleware n√†y c√≥ m·ªôt nhi·ªám v·ª• khi x·ª≠ l√Ω request: th√™m thu·ªôc t√≠nh `user` v√†o `request` m√† view s·∫Ω nh·∫≠n. Middleware n√†y gi√∫p ch√∫ng ta truy c·∫≠p b·∫£n ghi user r·∫•t ti·ªán l·ª£i.

```python
# application/views.py

from django.http import HttpResponse

def my_view(request):
    if request.user.is_authenticated:
        return HttpResponse(
            'You are logged in.'
        )
    else:
        return HttpResponse(
            'Hello guest!'
        )
```

`AuthenticationMiddleware` l√† th·ª© gi√∫p c√°c decorator t√¥i ƒë√£ m√¥ t·∫£ trong b√†i n√†y (nh∆∞ `login_required`, `user_passes_test`, v√† `permission_required`) ho·∫°t ƒë·ªông. M·ªói decorator s·∫Ω t√¨m b·∫£n ghi `user` nh∆∞ m·ªôt thu·ªôc t√≠nh g·∫Øn v√†o `request`.

C√≤n template th√¨ sao? N·∫øu b·∫°n ph·∫£i th√™m user v√†o context c·ªßa view cho m·ªçi view th√¨ s·∫Ω r·∫•t phi·ªÅn.

May m·∫Øn thay, c√≥ m·ªôt context processor t√™n l√† `auth` gi√∫p b·∫°n tr√°nh ƒë∆∞·ª£c ƒëi·ªÅu ƒë√≥ (processor n√†y n·∫±m trong `django.contrib.auth.context_processors`). Context processor n√†y s·∫Ω th√™m `user` v√†o context c·ªßa m·ªçi view khi x·ª≠ l√Ω request.

Nh·ªõ r·∫±ng context processor l√† m·ªôt h√†m nh·∫≠n object `request` v√† tr·∫£ v·ªÅ m·ªôt dictionary s·∫Ω ƒë∆∞·ª£c tr·ªôn v√†o context. Bi·∫øt v·∫≠y, b·∫°n ƒëo√°n context processor n√†y ho·∫°t ƒë·ªông th·∫ø n√†o?

N·∫øu b·∫°n ƒëo√°n l√† `AuthenticationMiddleware`, b·∫°n ƒë√∫ng r·ªìi ƒë·∫•y! üç™ V√¨ middleware th√™m `user` v√†o `request`, context processor ch·ªâ c·∫ßn t·∫°o dictionary nh∆∞ `{'user': request.user}`. Th·ª±c t·∫ø c√≥ th√™m m·ªôt ch√∫t chi ti·∫øt, b·∫°n c√≥ th·ªÉ xem [m√£ ngu·ªìn Django](https://github.com/django/django/blob/4.1/django/contrib/auth/context_processors.py#L49) n·∫øu mu·ªën bi·∫øt th√™m.

Th·ª±c t·∫ø n√≥ tr√¥ng nh∆∞ th·∫ø n√†o? Ch√∫ng ta ƒë√£ t·ª´ng th·∫•y r·ªìi! M·ªôt v√≠ d·ª• trong ph·∫ßn gi·∫£i th√≠ch template ƒë√£ d√πng bi·∫øn context `user`. ƒê√¢y l√† v√≠ d·ª• ƒë·ªÉ b·∫°n kh√¥ng ph·∫£i quay l·∫°i xem:

```django
{% if user.is_authenticated %}
    <h1>Welcome, {{ user.username }}</h1>
{% endif %}
```

N·∫øu b·∫°n d√πng quy·ªÅn c·ªßa Django, b·∫°n c≈©ng c√≥ th·ªÉ t·∫≠n d·ª•ng bi·∫øn context `perms` trong template. Bi·∫øn n√†y c≈©ng ƒë∆∞·ª£c cung c·∫•p b·ªüi context processor `auth` v√† cho ph√©p template truy c·∫≠p quy·ªÅn c·ªßa `user` m·ªôt c√°ch ng·∫Øn g·ªçn. [T√†i li·ªáu Django](https://docs.djangoproject.com/en/4.1/topics/auth/default/#permissions) c√≥ m·ªôt s·ªë v√≠ d·ª• hay v·ªÅ c√°ch d√πng bi·∫øn `perms`.

Gi·ªù b·∫°n ƒë√£ th·∫•y Django t·∫≠n d·ª•ng middleware x√°c th·ª±c ƒë·ªÉ gi√∫p truy c·∫≠p ng∆∞·ªùi d√πng d·ªÖ d√†ng trong view v√† template.

## T√≥m T·∫Øt

Trong b√†i vi·∫øt n√†y, ch√∫ng ta ƒë√£ t√¨m hi·ªÉu v·ªÅ h·ªá th·ªëng x√°c th·ª±c ng∆∞·ªùi d√πng t√≠ch h·ª£p c·ªßa Django.

Ch√∫ng ta ƒë√£ h·ªçc v·ªÅ:

- C√°ch thi·∫øt l·∫≠p x√°c th·ª±c
- Model `User` l√† g√¨
- C√°ch x√°c th·ª±c ho·∫°t ƒë·ªông
- C√°c view t√≠ch h·ª£p c·ªßa Django ƒë·ªÉ x√¢y d·ª±ng h·ªá th·ªëng ƒëƒÉng nh·∫≠p
- C√°c m·ª©c ph√¢n quy·ªÅn c√≥ s·∫µn
- C√°ch truy c·∫≠p ng∆∞·ªùi d√πng trong view v√† template

L·∫ßn t·ªõi ch√∫ng ta s·∫Ω t√¨m hi·ªÉu v·ªÅ middleware trong Django. ƒê√∫ng nh∆∞ t√™n g·ªçi, middleware l√† ƒëo·∫°n m√£ t·ªìn t·∫°i ·ªü ‚Äúgi·ªØa‚Äù qu√° tr√¨nh request v√† response. Ch√∫ng ta s·∫Ω h·ªçc v·ªÅ:

- M√¥ h√¨nh t∆∞ duy khi l√†m vi·ªác v·ªõi middleware
- C√°ch t·ª± vi·∫øt middleware
- M·ªôt s·ªë class middleware ƒëi k√®m Django
